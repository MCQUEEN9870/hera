# Production profile – secure defaults

# DataSource (must be provided via env or secrets manager)
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASSWORD}

# JPA – do not auto-mutate schema in prod
spring.jpa.hibernate.ddl-auto=validate

# Premium pricing (server-authoritative). Amounts are in INR.
# You can override these via environment variables on the server.
app.premium.pricing.monthly.inr=59
app.premium.pricing.quarterly.inr=159
app.premium.pricing.half-yearly.inr=299
app.premium.pricing.yearly.inr=499

# Step 7: Rate limiting (production defaults). Override via env vars as needed.
app.ratelimit.auth.login.ip.limit=10
app.ratelimit.auth.login.ip.window-seconds=300
app.ratelimit.auth.login.contact.limit=5
app.ratelimit.auth.login.contact.window-seconds=300

# Next step: Password login lockout (per contact number, in-memory)
app.auth.lockout.max-failures=5
app.auth.lockout.window-seconds=600
app.auth.lockout.lock-seconds=600

app.ratelimit.auth.check-user.ip.limit=30
app.ratelimit.auth.check-user.ip.window-seconds=60

app.ratelimit.auth.signup.ip.limit=10
app.ratelimit.auth.signup.ip.window-seconds=600
app.ratelimit.auth.signup.contact.limit=3
app.ratelimit.auth.signup.contact.window-seconds=600

app.ratelimit.auth.otp.verify.ip.limit=25
app.ratelimit.auth.otp.verify.ip.window-seconds=300
app.ratelimit.auth.otp.verify.contact.limit=10
app.ratelimit.auth.otp.verify.contact.window-seconds=300

app.ratelimit.payments.create-order.ip.limit=10
app.ratelimit.payments.create-order.ip.window-seconds=60
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.open-in-view=false

# Flyway
# Recovery setting: if `flyway_schema_history` was deleted but the schema already has tables,
# baseline will recreate the history table so the app can start.
spring.flyway.baseline-on-migrate=true
spring.flyway.schemas=public
spring.flyway.default-schema=public

# Logging – minimize sensitive output
logging.level.root=INFO
logging.level.org.hibernate.SQL=ERROR
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=ERROR

# Supabase (provided via env)
supabase.url=${SUPABASE_URL}
supabase.key=${SUPABASE_KEY}
supabase.bucket.name=${SUPABASE_BUCKET:vehicle-images}
supabase.profile.bucket.name=${SUPABASE_PROFILE_BUCKET:profile-photos}

# Server
server.port=${PORT:8080}
server.forward-headers-strategy=framework
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=20s

# CORS (prod) – set your domain(s) only
app.cors.allowed-origins=https://herapherigoods.in,https://www.herapherigoods.in
app.frontendBaseUrl=https://www.herapherigoods.in

# CAPTCHA (enable in prod)
captcha.enabled=true
captcha.secret=${CAPTCHA_SECRET}

razorpay.key.id=${RAZORPAY_KEY_ID}
razorpay.key.secret=${RAZORPAY_KEY_SECRET}

# 2Factor SMS (provided via env in prod)
twofactor.api.key=${TWOFACTOR_API_KEY}
sms.enabled=${SMS_ENABLED:true}

# Email (Brevo Transactional)
mail.enabled=${MAIL_ENABLED:true}
mail.notifications.enabled=${MAIL_NOTIFICATIONS_ENABLED:true}
brevo.api.key=${BREVO_API_KEY}
mail.from.email=${MAIL_FROM_EMAIL:info@herapherigoods.in}
mail.from.name=${MAIL_FROM_NAME:Herapherigoods Team}

# Email OTP password reset
security.password-reset.email-otp.enabled=${SECURITY_PWRESET_EMAIL_OTP_ENABLED:true}
security.password-reset.email-otp.ttl-seconds=${SECURITY_PWRESET_EMAIL_OTP_TTL_SECONDS:60}
security.password-reset.email-otp.reset-token-ttl-minutes=${SECURITY_PWRESET_EMAIL_OTP_TOKEN_TTL_MINUTES:10}
security.password-reset.email-otp.pepper=${SECURITY_PWRESET_EMAIL_OTP_PEPPER}

# Email OTP security policy
security.password-reset.email-otp.max-attempts=${SECURITY_PWRESET_EMAIL_OTP_MAX_ATTEMPTS:15}

# JWT auth (required in prod)
app.jwt.secret=${JWT_SECRET}
# 30 days by default
app.jwt.ttl-seconds=${JWT_TTL_SECONDS:604800}

# 2Factor template enforcement in prod
twofactor.template.login=${TWOFACTOR_TEMPLATE_LOGIN:userloginotp}
twofactor.template.signup=${TWOFACTOR_TEMPLATE_SIGNUP:usersignup}
twofactor.autogen.template-only=${TWOFACTOR_AUTOGEN_TEMPLATE_ONLY:true}


# Email (Zoho SMTP) - enable via env vars
mail.enabled=${MAIL_ENABLED:true}
mail.from=${MAIL_FROM:info@herapherigoods.in}
mail.admin.to=${MAIL_ADMIN_TO:info@herapherigoods.in}

spring.mail.host=${ZOHO_SMTP_HOST:smtp.zoho.in}
spring.mail.port=${ZOHO_SMTP_PORT:587}
spring.mail.username=${ZOHO_SMTP_USERNAME:info@herapherigoods.in}
spring.mail.password=${ZOHO_SMTP_PASSWORD:}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000

# Protected test endpoint for SMTP diagnostics (/api/mail/test).
mail.test.token=${MAIL_TEST_TOKEN:}


# HikariCP – keep pool tiny for PgBouncer & prevent hitting max connections
spring.datasource.hikari.pool-name=HeraHikariPool
spring.datasource.hikari.maximum-pool-size=${DB_POOL_MAX:5}
spring.datasource.hikari.minimum-idle=${DB_POOL_MIN:0}
spring.datasource.hikari.idle-timeout=60000
spring.datasource.hikari.max-lifetime=300000
spring.datasource.hikari.connection-timeout=30000
# Important for PgBouncer transaction pooling (avoid server-side prepared statements)
spring.datasource.hikari.data-source-properties.prepareThreshold=0


# Email
mail.enabled=${MAIL_ENABLED:true}
mail.notifications.enabled=${MAIL_NOTIFICATIONS_ENABLED:true}
mail.from=${MAIL_FROM:info@herapherigoods.in}
mail.admin.to=${MAIL_ADMIN_TO:info@herapherigoods.in}

# Scheduled reminders (OFF by default)
mail.reminders.enabled=${MAIL_REMINDERS_ENABLED:false}
mail.reminders.cron=${MAIL_REMINDERS_CRON:0 0 10 * * *}
mail.reminders.signup-no-vehicle.days=${MAIL_REMINDER_SIGNUP_NO_VEHICLE_DAYS:2,7}
mail.reminders.batch-size=${MAIL_REMINDERS_BATCH_SIZE:200}

# Welcome email optimization (avoid wasted usage)
mail.welcome.delayed.enabled=${MAIL_WELCOME_DELAYED_ENABLED:true}
mail.welcome.delayed.delay-minutes=${MAIL_WELCOME_DELAY_MINUTES:5}
mail.welcome.delayed.cron=${MAIL_WELCOME_DELAY_CRON:0 * * * * *}
mail.welcome.delayed.batch-size=${MAIL_WELCOME_DELAY_BATCH_SIZE:200}

# Docs reminders (RC/DL) - OFF by default
mail.docs.reminders.enabled=${MAIL_DOCS_REMINDERS_ENABLED:false}
mail.docs.reminders.cron=${MAIL_DOCS_REMINDERS_CRON:0 30 10 * * *}
mail.docs.reminders.batch-size=${MAIL_DOCS_REMINDERS_BATCH_SIZE:200}
mail.docs.reminders.first-after-days=${MAIL_DOCS_REMINDERS_FIRST_AFTER_DAYS:2}
mail.docs.reminders.second-after-days=${MAIL_DOCS_REMINDERS_SECOND_AFTER_DAYS:30}

# Require email confirmation for destructive actions
deletion.confirmation.required=${DELETION_CONFIRMATION_REQUIRED:true}

# Site branding (used in transactional emails)
app.site.name=${APP_SITE_NAME:Herapherigoods}
app.site.url=${APP_SITE_URL:https://www.herapherigoods.in}
app.api.url=${APP_API_URL:https://api.herapherigoods.in}
app.site.logo.url=${APP_SITE_LOGO_URL:https://www.herapherigoods.in/attached_assets/images/1200x630.jpg}

# Social links (used in email footer)
app.social.youtube.url=${APP_SOCIAL_YOUTUBE_URL:https://youtu.be/FREi_Lb4gWY}
app.social.facebook.url=${APP_SOCIAL_FACEBOOK_URL:https://www.facebook.com/share/1AYuAxKGzs/}
app.social.whatsapp.group.url=${APP_SOCIAL_WHATSAPP_GROUP_URL:https://chat.whatsapp.com/LMUfgwk7qwOCh7p4Gxy0tc}

# Brevo Transactional Email API
brevo.api.key=${BREVO_API_KEY:}
brevo.api.base-url=${BREVO_API_BASE_URL:https://api.brevo.com/v3}
brevo.sender.name=${BREVO_SENDER_NAME:Herapherigoods Team}

# Protected test endpoint (/api/mail/test)
mail.test.token=${MAIL_TEST_TOKEN:}