<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V9X30VY879"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-V9X30VY879');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Critical CSS: prevent brief flash before main stylesheet loads -->
    <style>
        html { box-sizing: border-box; }
        *, *::before, *::after { box-sizing: inherit; }
        body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
        img { max-width: 100%; height: auto; display: block; }
        .nav-links { list-style: none; margin: 0; padding: 0; display: flex; gap: 12px; }
        .dropdown-content { display: none; }
        .mobile-sidebar, .share-drawer .share-content, .review-content { display: none; }
    </style>
    <title>Find Vehicles Near You - Transport Owner Details Free</title>
    <meta property="og:title" content="Find Transport Vehicles Near You | Herapherigoods">
    <meta name="twitter:title" content="Find Transport Vehicles Near You | Herapherigoods">
    <meta name="description" content="Find transport vehicles by pincode. View images, check capacity & contact owners directly — No brokers, no commission." />
    <meta property="og:description" content="Find transport vehicles by pincode. View images, check capacity & contact owners directly — No brokers, No commission." />
    <meta name="twitter:description" content="Find transport vehicles by pincode. View images, check capacity & contact owners directly — No brokers, No commission." />
    <!-- Social Media Meta Tags -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://herapherigoods.in/find-vehicles" />
    <meta property="og:site_name" content="Herapherigoods" />
    <meta property="og:image" content="attached_assets/images/1200x630.jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="attached_assets/images/1200x630.jpg" />
    <link rel="canonical" href="https://herapherigoods.in/find-vehicles" />
    <link rel="stylesheet" href="style.css?v=20260108-1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
     
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
     <link rel="manifest" href="site.webmanifest">
    
    
    <style>
        /* Modern Vehicles Page Styles */
        .vehicles-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(92deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        @media(max-width:768px){
            .vehicles-container { padding: 0px; }
        }

        /* Multi-Step Progress Bar */
        .progress-container {
            border-radius: 20px;
            padding: 2px;
            margin-bottom: 5px;
            
        }

        .progress-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .progress-header h2 {
            font-size: 32px;
            color: #2c3e50;
            margin: 5px 0 10px 0;
            font-weight: 700;
        }

        .progress-subtitle {
            color: #7f8c8d;
            font-size: 14px;
            min-height: 18px;
        }

        .steps-wrapper {
            position: relative;
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 0 0;
        }

        .step-line {
            position: absolute;
            top: 30px;
            left: 10%;
            right: 10%;
            height: 3px;
            background: linear-gradient(90deg,#e53935,#e0e0e0);
            z-index: 1;
        }

        .step-line-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg,#e53935,#e53935);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1), background 0.6s ease;
            border-radius: 3px;
        }

        .step {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            border: 3px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #bdc3c7;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .step.active .step-circle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            animation: pulse 2s infinite;
        }

        .step.completed .step-circle {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border-color: #4CAF50;
            color: white;
        }

        .step.completed .step-circle::after {
            content: '✓';
            position: absolute;
            font-size: 28px;
            font-weight: bold;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); }
            50% { box-shadow: 0 6px 30px rgba(102, 126, 234, 0.6); }
        }

        .step-label {
            margin-top: 12px;
            font-size: 13px;
            font-weight: 600;
            color: #95a5a6;
            text-align: center;
            transition: all 0.3s ease;
        }

        .step.active .step-label {
            color: #667eea;
            font-size: 14px;
        }

        .step.completed .step-label {
            color: #4CAF50;
        }

        /* Modern Search Card */
        .search-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            margin-bottom: 5px;
        }
        @media(max-width:768px){
            .search-section { padding: 12px;
            }
        }

        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            align-items: end;
        }

        /* Vehicle Category icon cards */
        .vehicle-category-cards {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 12px;
            margin: 10px 0 10px 0;
        }
        @media(max-width: 700px){
            .vehicle-category-cards { grid-template-columns: 1fr; }
        }
        .vehicle-category-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            border-radius: 14px;
            border: 1px solid #e5e7eb;
            background: #ffffff;
            cursor: pointer;
            user-select: none;
            transition: transform .15s ease, box-shadow .25s ease, border-color .25s ease;
            min-width: 0;
        }
        .vehicle-category-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.08);
        }
        .vehicle-category-card.active {
            border-color: #667eea;
            box-shadow: 0 14px 34px rgba(102, 126, 234, 0.22);
        }
        .vehicle-category-card img {
            width: 44px;
            height: 44px;
            object-fit: contain;
            border-radius: 12px;
            background: #f3f4f6;
            padding: 7px;
            flex: 0 0 auto;
        }
        .vehicle-category-card .text {
            display: flex;
            flex-direction: column;
            gap: 3px;
            line-height: 1.2;
            text-align: left;
            min-width: 0;
        }
        .vehicle-category-card .title {
            font-weight: 800;
            color: #111827;
            font-size: 14px;
            word-break: break-word;
        }
        .vehicle-category-card .subtitle {
            font-size: 12px;
            color: #6b7280;
            word-break: break-word;
        }

        /* Desktop: keep category cards on their own full row (1x3 layout) */
        .vehicle-category-form { grid-column: 1 / -1; }
        .form-group.shake { animation: shake 0.5s ease; }
        @keyframes shake {
            0%,100% { transform: translateX(0); }
            15% { transform: translateX(-6px); }
            30% { transform: translateX(6px); }
            45% { transform: translateX(-5px); }
            60% { transform: translateX(5px); }
            75% { transform: translateX(-3px); }
            90% { transform: translateX(3px); }
        }

        .form-group {
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .form-group label {
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .form-group label i {
            color: #667eea;
        }

        .form-group select,
        .form-group input {
            padding: 14px 16px;
            border: 2px solid #e8eaed;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: #fafbfc;
            color: #2c3e50;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .form-group select:disabled,
        .form-group input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.6;
        }


        .pincode-actions {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }

        .location-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
        }

        .location-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .location-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.4);
        }

        .search-btn {
            padding: 14px 30px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(76, 175, 80, 0.4);
        }

        .search-btn:active {
            transform: translateY(0);
        }

        .helper-text {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .helper-text i {
            color: #3498db;
        }

        /* Results Section */
        .results-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }
        @media(max-width:768px){
            .results-section {
            padding: 3px;
            border-radius: 0px;
            
            }
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f2f5;
        }

        .results-count {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
        }
        @media(max-width:768px){
            .results-count {
            font-size: 18px;
            margin-top: 10px;
            }
        }

        /* Pagination Controls */
        .pagination-controls { margin-top: 25px; display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
        .pagination-controls button { background:#ffffff; border:1px solid #d6d9de; padding:8px 14px; border-radius:8px; cursor:pointer; font-size:14px; min-width:42px; transition:.25s; }
        .pagination-controls button:hover { border-color:#667eea; color:#667eea; }
        .pagination-controls button.active { background:#667eea; color:#fff; border-color:#667eea; font-weight:600; }
        .pagination-controls button:disabled { opacity:.4; cursor:not-allowed; }

        .vehicles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }
        @media(max-width:768px){
            .vehicles-grid {
            gap: 15px;
            }
        }

        .vehicle-card {
            border: 2px solid #f0f2f5;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            cursor: pointer;
            position: relative;
        }

        .vehicle-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
            border-color: #667eea;
        }
        
        /* Premium Vehicle Card Styling */
        .premium-vehicle {
            border: 2px solid #FFD700;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            position: relative;
            z-index: 2;
        }
        
        .premium-vehicle:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.5);
        }
        
        .premium-vehicle::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #FFD700, #FFA500, #FFD700);
            z-index: 3;
        }
        
        /* Premium title and button styles */
        .premium-title {
            color: #333;
            font-weight: 700;
            background: -webkit-linear-gradient(45deg, #FFD700, #FFA500);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .premium-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            font-weight: 600;
            border: none;
            box-shadow: 0 3px 10px rgba(255, 165, 0, 0.3);
        }
        
        .premium-btn:hover {
            background: linear-gradient(45deg, #FFA500, #FF8C00);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 165, 0, 0.5);
        }
        
        /* Premium info items */
        .premium-info-item {
            background: rgba(255, 215, 0, 0.1);
            border-left: 3px solid #FFD700;
            padding: 5px 8px;
            margin: 5px 0;
            border-radius: 0 4px 4px 0;
        }
        
        /* Premium highlights */
        .premium-highlights {
            margin-top: 10px;
        }
        
        .premium-tag {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(255, 165, 0, 0.3);
        }
        
        .premium-more {
            background: rgba(255, 215, 0, 0.2);
            color: #000;
            border: 1px solid #FFD700;
        }

        .vehicle-image {
            height: 200px;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        

        .vehicle-card:hover .vehicle-image img {
            transform: scale(1.05);
        }

        .vehicle-details {
            padding: 15px;
        }

        .vehicle-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .vehicle-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #666;
        }

        .info-item i {
            color: #ffa500;
            width: 16px;
        }

        .service-highlights {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .highlight-tag {
            display: inline-block;
            background-color: #e6f7ff;
            color: #0066cc;
            border: 1px solid #99ccff;
            border-radius: 12px;
            padding: 3px 10px;
            font-size: 12px;
            font-weight: 500;
        }

        .highlight-more {
            display: inline-block;
            background-color: #f0f0f0;
            color: #666;
            border-radius: 12px;
            padding: 3px 10px;
            font-size: 12px;
            font-weight: 500;
        }

        .vehicle-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .view-details-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-details-btn:hover {
            background-color: #0069d9;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-results {
            text-align: center;
            padding: 50px 0;
            color: #666;
        }

        .no-results i {
            font-size: 50px;
            color: #ddd;
            margin-bottom: 20px;
        }

        .no-results h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        /* Pincode verification styles */
        .pincode-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* verify-pincode-btn styles removed */

        .location-note {
            font-size: 12px;
            color: #edebebfd;
            margin-top: 5px;
        }

        /* Toast message styles */
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, 20px); }
            10% { opacity: 1; transform: translate(-50%, 0); }
            90% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -20px); }
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 8px;
            color: rgb(255, 255, 255);
            z-index: 1000;
            animation: fadeInOut 5s forwards;
            background-color: #c20812;
        }

        .toast.success {
            background-color: #4CAF50;
        }

        .toast.error {
            background-color: #f44336;
        }

        /* Modal for vehicle details */
        .vehicle-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 50px auto;
            max-width: 800px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            color: white;
            background: rgba(0,0,0,0.5);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
        }

        .modal-close:hover {
            background: rgba(0,0,0,0.7);
        }

        .modal-header {
            position: relative;
            height: 300px;
        }

        .modal-header-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Fullscreen Image Viewer */
        .image-lightbox {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .image-lightbox.active { display: flex; }
        .image-lightbox img {
            max-width: 95vw;
            max-height: 90vh;
            border-radius: 6px;
            box-shadow: 0 10px 30px rgba(0,0,0,.4);
        }
        .image-lightbox .close-lightbox {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #fff;
            font-size: 28px;
            background: rgba(255,255,255,.15);
            width: 40px; height: 40px; border-radius: 50%;
            display:flex; align-items:center; justify-content:center;
            cursor: pointer;
        }

        .modal-header-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
        }

        .modal-vehicle-title {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .modal-vehicle-type {
            display: inline-block;
            background: #ffa500;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .modal-gallery {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 20px;
        }

        .gallery-item {
            height: 100px;
            cursor: pointer;
            border-radius: 5px;
            overflow: hidden;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.3s ease;
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .modal-info {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .modal-section {
            margin-bottom: 20px;
        }

        .modal-section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #ffa500;
            padding-bottom: 8px;
            display: inline-block;
        }

        .modal-info-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .modal-info-item {
            display: flex;
            margin-bottom: 12px;
            align-items: flex-start;
        }

        .info-icon {
            color: #ffa500;
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .info-content {
            flex: 1;
        }

        .info-label {
            font-weight: 500;
            color: #666;
            margin-bottom: 3px;
            font-size: 14px;
        }

        .info-value {
            color: #333;
            font-size: 16px;
        }

        .modal-actions {
            padding: 20px;
            background-color: #f9f9f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .contact-driver-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .contact-driver-btn:hover {
            background-color: #218838;
        }

        .favorite-btn {
            background-color: white;
            color: #dc3545;
            border: 1px solid #dc3545;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .favorite-btn:hover {
            background-color: #dc3545;
            color: white;
        }

        /* Copy and call button styles */
        .copy-btn, .call-btn {
            cursor: pointer;
            color: #007bff;
            margin-left: 8px;
            padding: 3px;
            border-radius: 3px;
            transition: all 0.2s ease;
        }

        .copy-btn:hover, .call-btn:hover {
            background-color: #f0f0f0;
        }

        .call-btn {
            color: #28a745;
        }

        .info-value-container {
            display: flex;
            align-items: center;
        }

        .call-driver-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .call-driver-btn:hover {
            background-color: #0069d9;
        }

        /* Trust counter styles */
        .trust-counter {
            display: flex;
            align-items: center;
            gap: 5px;
            background-color: #f8f9fa;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 13px;
            color: #495057;
            margin-right: 10px;
        }

        .trust-counter i {
            color: #28a745;
        }

        .trust-counter-large {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: #e9f7ef;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .trust-counter-large i {
            color: #27ae60;
            font-size: 16px;
        }

        .trust-counter-number {
            font-weight: 600;
        }

        /* Trust indicator styles */
        .trust-indicator {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .trust-indicator-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
        }

        .trust-indicator-message {
            font-size: 14px;
            line-height: 1.4;
        }

        .trust-level-low {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
        }

        .trust-level-low .trust-indicator-header i {
            color: #ffc107;
        }

        .trust-level-medium {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
        }

        .trust-level-medium .trust-indicator-header i {
            color: #4caf50;
        }

        .trust-level-high {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
        }

        .trust-level-high .trust-indicator-header i {
            color: #2196f3;
        }

        .trust-level-highest {
            background-color: #ede7f6;
            border-left: 4px solid #673ab7;
        }

        .trust-level-highest .trust-indicator-header i {
            color: #673ab7;
        }
        
        /* New vehicle indicator styles */
        .new-vehicle-badge {
            position: absolute;
            top: 0px;
            right: 0px;
            z-index: 2;
            width: 40px;
            height: 46px;
            border-radius: 0;
            overflow: hidden;
        }
        
        .new-vehicle-badge img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .verified-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 2;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .verified-badge img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Premium ribbon */
        .premium-ribbon {
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            height: 120px;
            overflow: hidden;
            z-index: 2;
        }
        
        .premium-ribbon::before {
            content: 'PREMIUM';
            position: absolute;
            top: 30px;
            right: -30px;
            transform: rotate(45deg);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            padding: 5px 40px;
            font-weight: bold;
            font-size: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            text-shadow: 0 1px 1px rgba(255,255,255,0.5);
        }

        @media (max-width: 768px) {
            .search-form {
                grid-template-columns: 1fr;
            }
            
            /* Responsive styles for badges */
            .new-vehicle-badge {
                width: 30px;
                height: 35px;
                top: 5px;
                right: 5px;
            }
            
            .verified-badge {
                width: 30px;
                height: 30px;
                top: 10px;
                left: 10px;
            }
            
            .premium-badge {
                top: 45px;
                left: 10px;
                font-size: 10px;
                padding: 3px 8px;
            }

            .vehicles-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .modal-info {
                grid-template-columns: 1fr;
            }

            .modal-gallery {
                grid-template-columns: repeat(2, 1fr);
            }

            .modal-actions {
                flex-direction: column;
                gap: 10px;
            }

            .contact-driver-btn, .favorite-btn, .call-driver-btn {
                width: 100%;
                justify-content: center;
            }
            
            .pincode-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            /* verify-pincode-btn responsive rule removed */
        }

        /* Compact two-up card layout on small mobiles */
        @media (max-width: 600px) {
            .vehicles-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 10px; }
            .vehicle-card { border-radius: 12px; }
            .vehicle-image { height: 140px; }
            .vehicle-details { padding: 10px; }
            .vehicle-title { font-size: 14px; line-height: 1.3; margin-bottom: 6px; }
            .vehicle-info { gap: 6px; }
            .info-item { font-size: 12px; gap: 6px; }
            .view-details-btn { width: 100%; padding: 8px 10px; font-size: 13px; }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar Section -->
    <nav class="navbar" style ="height: 115px;">
        <ul class="nav-links">
           <li>
                <a href="index" class="nav-item"><span>Home</span></a>
            </li>
            
            <!-- Authentication Section - Only shown when user is logged in -->
            <li id="authSection" style="display: none;">
                <a href="driver-dashboard" class="nav-item"> 
                    <span>
                        <img loading="lazy" decoding="async" src="attached_assets/images/user.webp" class="profile-icon" alt="User profile" title="User profile">
                    </span>
                </a>
            </li>
        </ul> 
        
        <style>
            .profile-icon {
                width: 40px;
                height: 40px;
                border-radius: 40%;
                margin-top: -10px;
            }
        </style>
    </nav>

    <!-- Main Content -->
    <div class="vehicles-container">
        <!-- Multi-Step Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2>Find Your Perfect Transport Vehicle</h2>
                <p class="progress-subtitle" id="stepTip">Choose a vehicle type to begin</p>
            </div>
            
            <div class="steps-wrapper">
                <div class="step-line">
                    <div class="step-line-progress" id="stepLineProgress"></div>
                </div>
                
                <div class="step" data-step="1">
                    <div class="step-circle">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <div class="step-label">Vehicle Category</div>
                </div>

                <div class="step" data-step="2">
                    <div class="step-circle">
                        <i class="fas fa-truck"></i>
                    </div>
                    <div class="step-label">Vehicle Type</div>
                </div>
                
                <div class="step" data-step="3">
                    <div class="step-circle">
                        <i class="fas fa-map-marked-alt"></i>
                    </div>
                    <div class="step-label">State</div>
                </div>
                
                <div class="step" data-step="4">
                    <div class="step-circle">
                        <i class="fas fa-city"></i>
                    </div>
                    <div class="step-label">District</div>
                </div>
                
                <div class="step" data-step="5">
                    <div class="step-circle">
                        <i class="fas fa-map-pin"></i>
                    </div>
                    <div class="step-label">Pincode</div>
                </div>
                
                <div class="step" data-step="6">
                    <div class="step-circle">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="step-label">Search</div>
                </div>
            </div>
        </div>

        <!-- Search Section -->
        <section class="search-section">
            <form id="vehicleSearchForm" class="search-form">
                <div class="form-group vehicle-category-form">
                    <label for="vehicleCategory">
                        Vehicle Category
                    </label>

                    <div class="vehicle-category-cards" role="group" aria-label="Vehicle Category">
                        <div class="vehicle-category-card" data-category-value="goods" tabindex="0" role="button" aria-pressed="false">
                            <img src="attached_assets/images/goods-vehicles.webp" alt="Goods & Special Utility Vehicles" loading="lazy" decoding="async">
                            <div class="text">
                                <div class="title">Goods &amp; Special Utility Vehicles</div>
                                <div class="subtitle">Loaders, Garbage/Tow/Food Trucks, Tempos, JCBs, Crane, Packers &amp; Movers, etc.</div>
                            </div>
                        </div>
                        <div class="vehicle-category-card" data-category-value="passenger" tabindex="0" role="button" aria-pressed="false">
                            <img src="attached_assets/images/passenger-vehicles.webp" alt="Passenger Vehicles" loading="lazy" decoding="async">
                            <div class="text">
                                <div class="title">Passenger Vehicles</div>
                                <div class="subtitle">Cabs, Buses, A.C/Luxury/Sleeper Buses, etc.</div>
                            </div>
                        </div>
                        <div class="vehicle-category-card" data-category-value="rental" tabindex="0" role="button" aria-pressed="false">
                            <img src="attached_assets/images/rent-vehicles.webp" alt="Rental & Events" loading="lazy" decoding="async">
                            <div class="text">
                                <div class="title">Rental &amp; Events</div>
                                <div class="subtitle">For Royal Wedding, Vintage cars &amp; VIP rentals, etc.</div>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="vehicleCategory" name="vehicleCategory" value="">
                </div>

                <div class="form-group">
                    <label for="vehicleType">
                        Vehicle Type
                    </label>
                    <select id="vehicleType" name="vehicleType">
                        <option value="">Select Vehicle Type</option>
                        
                        <!-- Small Commercial Vehicles (SCV) -->
                        <optgroup label="🚛 Small Transport Vehicles (SCV)" data-category="goods">
                            <option value="Manual Cart (Thel / Rickshaw)">Manual Cart (Thel / Rickshaw)</option>
                            <option value="Auto Loader (CNG loader)">Auto Loader (CNG loader)</option>
                            <option value="Tata Ace (Chhota Hathi)">Tata Ace (Chhota Hathi)</option>
                            <option value="E-Rickshaw Loader (Tuk-Tuk)">E-Rickshaw Loader (Tuk-Tuk)</option>
                        </optgroup>
                        
                        <!-- Light Commercial Vehicles (LCV) -->
                        <optgroup label="🚚 Light Transport Vehicles (LCV)" data-category="goods">
                            <option value="Mini Truck (Eicher Canter)">Mini Truck (Eicher Canter)</option>
                            <option value="Vikram Tempo">Vikram Tempo</option>
                            <option value="Bolero Pickup (MaXX)">Bolero Pickup (MaXX)</option>
                            <option value="Tata 407">Tata 407</option>
                            <option value="6 wheeler">6 wheeler</option>
                        </optgroup>
                        
                        <!-- Medium & Heavy Commercial Vehicles (MHCV & HCV) -->
                        <optgroup label="🚛 Medium & Heavy Transport Vehicles (MHCV & HCV)" data-category="goods">
                            <option value="Container Truck">Container Truck</option>
                            <option value="Open Body Truck (6 wheeler)">Open Body Truck (6 wheeler)</option>
                            <option value="Closed Body Truck">Closed Body Truck</option>
                            <option value="Flatbed Truck">Flatbed Truck</option>
                            <option value="8 wheeler">8 wheeler</option>
                            <option value="12 wheeler and onwards">12 wheeler and onwards</option>
                        </optgroup>
                        
                        <!-- Special Utility Vehicles (SUV) -->
                        <optgroup label="🔧 Special Utility Vehicles" data-category="goods">
                            <option value="JCB">JCB</option>
                            <option value="Crane">Crane</option>
                            <option value="Trailer Truck">Trailer Truck</option>
                            <option value="Tipper Truck (Dumper Truck)">Tipper Truck (Dumper Truck)</option>
                            <option value="Tanker Truck">Tanker Truck</option>
                            <option value="Garbage Truck">Garbage Truck</option>
                        </optgroup>
                        
                        <!-- Emergency Vehicles -->
                        <optgroup label="🚑 Emergency Vehicles" data-category="goods">
                            <option value="Ambulance">Ambulance</option>
                            <option value="Tow-Truck">Tow-Truck</option>
                        </optgroup>
                        
                        <!-- Refrigerated & AC Vehicles -->
                        <optgroup label="❄️ Refrigerated & AC Vehicles" data-category="goods">
                            <option value="Refrigerated Vans">Refrigerated Vans</option>
                            <option value="Refrigerated Trucks">Refrigerated Trucks</option>
                        </optgroup>
                        
                        <!-- Service-Based Vehicles -->
                        <optgroup label="📦 Service-Based Vehicles" data-category="goods">
                            <option value="Packer&Movers">Packer&Movers</option>
                            <option value="Parcel Delivery">Parcel Delivery</option>
                        </optgroup>
                        
                        <!-- Food & Beverage Vehicles -->
                        <optgroup label="🍔 Food & Beverage Vehicles" data-category="goods">
                            <option value="Food trucks">Food-Based vehicles</option>
                            <option value="Beverage trucks">Drink-Based vehicles</option>
                        </optgroup>
                        
                        <!-- Local & Long-Distance Cabs -->
                        <optgroup label="🚖 Local & Long-Distance Cabs" data-category="passenger">
                            <option value="Innova Crysta">Innova Crysta</option>
                            <option value="Ertiga">Ertiga</option>
                            <option value="Dzire">Dzire</option>
                            <option value="Sedan (Verna, Ciaz, etc.)">Sedan (Verna, Ciaz, etc.)</option>
                            <option value="Hatchback (WagonR, i10, etc.)">Hatchback (WagonR, i10, etc.)</option>
                            <option value="Other Taxi Cars">Other Taxi Cars</option>
                        </optgroup>
                        
                        <!-- Tourist & Contract Buses -->
                        <optgroup label="🚌 Tourist & Contract Buses" data-category="passenger">
                            <option value="26-seater Mini Bus">26-seater Mini Bus</option>
                            <option value="35-seater AC Bus">35-seater AC Bus</option>
                            <option value="45+ Seater Tourist Coach">45+ Seater Tourist Coach</option>
                            <option value="Volvo Type Bus">Volvo Type Bus</option>
                            <option value="Other Bus Types">Other Bus Types</option>
                        </optgroup>
                        
                        <!-- Wedding & VIP Rentals -->
                        <optgroup label="💒 Wedding & VIP Rentals" data-category="rental">
                            <option value="Fortuner">Fortuner/Thar/Scorpio</option>
                            <option value="Audi/BMW/Mercedes">Audi/BMW/Mercedes</option>
                            <option value="Luxury Vintage Cars">Luxury Vintage Cars</option>
                            <option value="Open Jeep (Decorated)">Open Jeep (Decorated)</option>
                            <option value="SUV/MUV for Baraat">SUV/MUV for Weddings</option>
                            <option value="Other Rental Vehicles">Other Rental Vehicles</option>
                        </optgroup>
                    </select>
                    
                </div>

                <div class="form-group">
                    <label for="state">
                        State
                    </label>
                    <select id="state" name="state">
                        <option value="">Select State / UT</option>

                        <optgroup label="States (28)">
                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                            <option value="Assam">Assam</option>
                            <option value="Bihar">Bihar</option>
                            <option value="Chhattisgarh">Chhattisgarh</option>
                            <option value="Goa">Goa</option>
                            <option value="Gujarat">Gujarat</option>
                            <option value="Haryana">Haryana</option>
                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                            <option value="Jharkhand">Jharkhand</option>
                            <option value="Karnataka">Karnataka</option>
                            <option value="Kerala">Kerala</option>
                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                            <option value="Maharashtra">Maharashtra</option>
                            <option value="Manipur">Manipur</option>
                            <option value="Meghalaya">Meghalaya</option>
                            <option value="Mizoram">Mizoram</option>
                            <option value="Nagaland">Nagaland</option>
                            <option value="Odisha">Odisha</option>
                            <option value="Punjab">Punjab</option>
                            <option value="Rajasthan">Rajasthan</option>
                            <option value="Sikkim">Sikkim</option>
                            <option value="Tamil Nadu">Tamil Nadu</option>
                            <option value="Telangana">Telangana</option>
                            <option value="Tripura">Tripura</option>
                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                            <option value="Uttarakhand">Uttarakhand</option>
                            <option value="West Bengal">West Bengal</option>
                        </optgroup>

                        <optgroup label="Union Territories (8)">
                            <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                            <option value="Chandigarh">Chandigarh</option>
                            <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                            <option value="Delhi">Delhi</option>
                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                            <option value="Ladakh">Ladakh</option>
                            <option value="Lakshadweep">Lakshadweep</option>
                            <option value="Puducherry">Puducherry</option>
                        </optgroup>
                    </select>
                    
                </div>

                <div class="form-group">
                    <label for="district">
                        District
                    </label>
                    <select id="district" name="district" disabled>
                        <option value="">Select District</option>
                    </select>
                    
                </div>

                <div class="form-group">
                    <label for="pincode">
                        Pincode (Required)
                    </label>
                    <input id="pincode" name="pincode" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="6" placeholder="Enter pincode" disabled>
                    <!-- Custom suggestions dropdown -->
                    <div id="pincodeSuggestions" class="pin-suggestions" style="display:none;"></div>
                    <button type="button" id="pincodeChevron" aria-label="Open pincode options" class="pin-chevron" style="display:none;" tabindex="-1">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="pincode-actions">
                        <button type="button" id="detectLocationBtn" class="location-btn">
                            Use Location
                        </button>
                    </div>
                    
                </div>

                <div class="form-group">
                    <label style="opacity: 1;">Search</label>
                    <button type="submit" class="search-btn">
                        Search Vehicles
                    </button>
                </div>
            </form>
        </section>

        <!-- Results Section -->
        <section class="results-section">
            <div class="results-header">
                <div class="results-count" id="resultsCount">Showing 0 vehicles</div>
                <!-- Sort options removed; backend provides oldest-first premium-priority ordering -->
            </div>

            <!-- Vehicles Grid - Will be populated with JavaScript -->
            <div class="vehicles-grid" id="vehiclesGrid">
                <!-- Vehicle cards will be inserted here -->
            </div>

            <nav class="pagination-nav" aria-label="Vehicle pages">
                <div id="paginationControls" class="pagination-controls" role="navigation"></div>
            </nav>

            <!-- No Results Message -->
            <div class="no-results" id="noResults" style="display: none;">
                <i class="fas fa-truck-moving"></i>
                <h3>No Vehicles Found</h3>
                <p id="novehiclefoundResultsMessage">Try adjusting your search criteria or check back later for new listings.</p>
            </div>
        </section>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Vehicle Details Modal -->
    <div class="vehicle-modal" id="vehicleModal">
        <div class="modal-content">
            <span class="modal-close" id="modalClose">&times;</span>
            <div class="modal-header" id="modalHeader">
                <!-- Will be populated with JavaScript -->
            </div>
            <div class="modal-gallery" id="modalGallery">
                <!-- Will be populated with JavaScript -->
            </div>
            <div class="modal-info" id="modalInfo">
                <!-- Will be populated with JavaScript -->
            </div>
            

            
            <div class="modal-actions">
                <button class="contact-driver-btn" id="contactDriverBtn">
                    <i class="fab fa-whatsapp"></i> Contact via WhatsApp
                </button>
                <button class="call-driver-btn" id="callDriverBtn">
                    <i class="fas fa-phone"></i> Call him
                </button>
            </div>
        </div>
    </div>

    <!-- Fullscreen Image Lightbox -->
    <div class="image-lightbox" id="imageLightbox">
        <span class="close-lightbox" id="closeLightbox">&times;</span>
    <img id="lightboxImage" src="" alt="Vehicle Photo" title="Vehicle Photo">
    </div>

   
    
    <!-- Vehicles JavaScript -->
    <script src="env.js?v=20260108-1"></script>
    <script src="seo.js?v=20260108-1"></script>
    <!-- Convert clean URLs /find-vehicles/{City}/{Type} (or legacy /vehicles/{City}/{Type}) -> ?city=...&type=... before vehicles.js runs -->
    <script>
        (function(){
            try {
                var segs = (window.location.pathname || '').split('/').filter(Boolean);
                // Find the index of 'vehicles' or 'vehicles.html'
                var vi = -1;
                for (var i = 0; i < segs.length; i++) {
                    var s = (segs[i] || '').toLowerCase();
                    if (s === 'find-vehicles' || s === 'find-vehicles.html' || s === 'vehicles' || s === 'vehicles.html') { vi = i; break; }
                }
                if (vi !== -1 && segs.length >= vi + 3) {
                    var citySeg = segs[vi + 1] || '';
                    var typeSegs = segs.slice(vi + 2);
                    var city = decodeURIComponent(citySeg).replace(/\+/g, ' ');
                    var type = decodeURIComponent(typeSegs.join('/')).replace(/\+/g, ' ');
                    var params = new URLSearchParams(window.location.search);
                    if (!params.has('city')) params.set('city', city);
                    if (!params.has('type')) params.set('type', type);
                    var newSearch = '?' + params.toString();
                    if (window.location.search !== newSearch) {
                        window.history.replaceState(null, '', window.location.pathname + newSearch);
                    }
                }
            } catch (e) {
                // no-op
            }
        })();
    </script>
    <script src="vehicles.js?v=20260117-1"></script>
    
    <!-- Progress Bar & Cascade JavaScript -->
    <script>
    (function() {
        // Selected vehicle type icon for step 1 circle (used by progress bar rendering)
        window.__selectedVehicleTypeIcon = null;
        // Selected vehicle category icon for step 1 circle (used by progress bar rendering)
        window.__selectedVehicleCategoryIcon = null;
        // ===== Pincode Suggestions CSS (scoped) =====
        const styleEl = document.createElement('style');
        styleEl.textContent = `
            .pin-suggestions {
                position: absolute;
                width: 100%;
                max-height: 380px;
                overflow-y: auto;
                background: #ffffff;
                color: #111827;
                border: 1px solid #e5e7eb;
                border-radius: 12px;
                box-shadow: 0 18px 40px rgba(0,0,0,0.18);
                z-index: 2000;
                margin-top: 8px;
                padding: 6px 0;
            }
            .pin-suggestion-item {
                padding: 12px 16px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 12px;
                cursor: pointer;
                transition: background 0.15s ease, border-color 0.15s ease;
                border-left: 3px solid transparent;
            }
            .pin-suggestion-item:hover, .pin-suggestion-item.active {
                background: #f3f4f6;
                border-left-color: #3b82f6;
            }
            .pin-suggestion-code { font-weight: 700; letter-spacing: 0.3px; color:#111827; }
            .pin-suggestion-name { color:#6b7280; font-size: 14px; }
            .form-group { position: relative; }
            .pin-chevron { position:absolute; right:12px; top:38px; width:34px; height:34px; border:none; background:transparent; color:#6b7280; display:flex; align-items:center; justify-content:center; cursor:pointer; }
            .pin-chevron:hover { color:#374151; }
            /* Verified styling: green border for the pincode input */
            #pincode.pin-verified { border-color:#10b981 !important; box-shadow: 0 0 0 4px rgba(16,185,129,0.15) !important; background:#ffffff; }
            /* Vehicle type icon image inside the step circle */
            .step .step-circle img.vehicle-type-step-icon { width: 36px; height: 36px; object-fit: contain; display: block; }
        `;
        document.head.appendChild(styleEl);
        // ===== State to District Mapping =====
        const stateToDistricts = {
            "Uttar Pradesh": ["Agra", "Aligarh", "Ambedkar Nagar", "Amethi", "Amroha", "Auraiya", "Ayodhya", "Azamgarh", "Baghpat", "Bahraich", "Ballia", "Balrampur", "Banda", "Barabanki", "Bareilly", "Basti", "Bhadohi", "Bijnor", "Budaun", "Bulandshahr", "Chandauli", "Chitrakoot", "Deoria", "Etah", "Etawah", "Farrukhabad", "Fatehpur", "Firozabad", "Gautam Buddha Nagar", "Ghaziabad", "Ghazipur", "Gonda", "Gorakhpur", "Hamirpur", "Hapur", "Hardoi", "Hathras", "Jalaun", "Jaunpur", "Jhansi", "Kannauj", "Kanpur Dehat", "Kanpur Nagar", "Kasganj", "Kaushambi", "Kushinagar", "Lakhimpur Kheri", "Lalitpur", "Lucknow", "Maharajganj", "Mahoba", "Mainpuri", "Mathura", "Mau", "Meerut", "Mirzapur", "Moradabad", "Muzaffarnagar", "Pilibhit", "Pratapgarh", "Prayagraj", "Raebareli", "Rampur", "Saharanpur", "Sambhal", "Sant Kabir Nagar", "Shahjahanpur", "Shamli", "Shravasti", "Siddharthnagar", "Sitapur", "Sonbhadra", "Sultanpur", "Unnao", "Varanasi"],
            "Maharashtra": ["Ahmednagar", "Akola", "Amravati", "Aurangabad", "Beed", "Bhandara", "Buldhana", "Chandrapur", "Dhule", "Gadchiroli", "Gondia", "Hingoli", "Jalgaon", "Jalna", "Kolhapur", "Latur", "Mumbai City", "Mumbai Suburban", "Nagpur", "Nanded", "Nandurbar", "Nashik", "Osmanabad", "Palghar", "Parbhani", "Pune", "Raigad", "Ratnagiri", "Sangli", "Satara", "Sindhudurg", "Solapur", "Thane", "Wardha", "Washim", "Yavatmal"],
            "Delhi": ["Central Delhi", "East Delhi", "New Delhi", "North Delhi", "North East Delhi", "North West Delhi", "Shahdara", "South Delhi", "South East Delhi", "South West Delhi", "West Delhi"],
            "Gujarat": ["Ahmedabad", "Amreli", "Anand", "Aravalli", "Banaskantha", "Bharuch", "Bhavnagar", "Botad", "Chhota Udaipur", "Dahod", "Dang", "Devbhoomi Dwarka", "Gandhinagar", "Gir Somnath", "Jamnagar", "Junagadh", "Kheda", "Kutch", "Mahisagar", "Mehsana", "Morbi", "Narmada", "Navsari", "Panchmahal", "Patan", "Porbandar", "Rajkot", "Sabarkantha", "Surat", "Surendranagar", "Tapi", "Vadodara", "Valsad"],
            "Rajasthan": ["Ajmer", "Alwar", "Banswara", "Baran", "Barmer", "Bharatpur", "Bhilwara", "Bikaner", "Bundi", "Chittorgarh", "Churu", "Dausa", "Dholpur", "Dungarpur", "Hanumangarh", "Jaipur", "Jaisalmer", "Jalore", "Jhalawar", "Jhunjhunu", "Jodhpur", "Karauli", "Kota", "Nagaur", "Pali", "Pratapgarh", "Rajsamand", "Sawai Madhopur", "Sikar", "Sirohi", "Sri Ganganagar", "Tonk", "Udaipur"],
            "Haryana": ["Ambala", "Bhiwani", "Charkhi Dadri", "Faridabad", "Fatehabad", "Gurugram", "Hisar", "Jhajjar", "Jind", "Kaithal", "Karnal", "Kurukshetra", "Mahendragarh", "Nuh", "Palwal", "Panchkula", "Panipat", "Rewari", "Rohtak", "Sirsa", "Sonipat", "Yamunanagar"],
            "Punjab": ["Amritsar", "Barnala", "Bathinda", "Faridkot", "Fatehgarh Sahib", "Fazilka", "Ferozepur", "Gurdaspur", "Hoshiarpur", "Jalandhar", "Kapurthala", "Ludhiana", "Mansa", "Moga", "Mohali", "Muktsar", "Pathankot", "Patiala", "Rupnagar", "Sangrur", "Shahid Bhagat Singh Nagar", "Tarn Taran"],
            "Andhra Pradesh": ["Anantapur", "Chittoor", "East Godavari", "Guntur", "Krishna", "Kurnool", "Nellore", "Prakasam", "Srikakulam", "Visakhapatnam", "Vizianagaram", "West Godavari", "YSR Kadapa"],
            "Karnataka": ["Bagalkot", "Ballari", "Belagavi", "Bengaluru Rural", "Bengaluru Urban", "Bidar", "Chamarajanagar", "Chikballapur", "Chikkamagaluru", "Chitradurga", "Dakshina Kannada", "Davanagere", "Dharwad", "Gadag", "Hassan", "Haveri", "Kalaburagi", "Kodagu", "Kolar", "Koppal", "Mandya", "Mysuru", "Raichur", "Ramanagara", "Shivamogga", "Tumakuru", "Udupi", "Uttara Kannada", "Vijayapura", "Yadgir"],
            "Tamil Nadu": ["Ariyalur", "Chengalpattu", "Chennai", "Coimbatore", "Cuddalore", "Dharmapuri", "Dindigul", "Erode", "Kallakurichi", "Kanchipuram", "Kanyakumari", "Karur", "Krishnagiri", "Madurai", "Mayiladuthurai", "Nagapattinam", "Namakkal", "Nilgiris", "Perambalur", "Pudukkottai", "Ramanathapuram", "Ranipet", "Salem", "Sivaganga", "Tenkasi", "Thanjavur", "Theni", "Thoothukudi", "Tiruchirappalli", "Tirunelveli", "Tirupathur", "Tiruppur", "Tiruvallur", "Tiruvannamalai", "Tiruvarur", "Vellore", "Viluppuram", "Virudhunagar"],
            "West Bengal": ["Alipurduar", "Bankura", "Birbhum", "Cooch Behar", "Dakshin Dinajpur", "Darjeeling", "Hooghly", "Howrah", "Jalpaiguri", "Jhargram", "Kalimpong", "Kolkata", "Malda", "Murshidabad", "Nadia", "North 24 Parganas", "Paschim Bardhaman", "Paschim Medinipur", "Purba Bardhaman", "Purba Medinipur", "Purulia", "South 24 Parganas", "Uttar Dinajpur"],
            "Kerala": ["Alappuzha", "Ernakulam", "Idukki", "Kannur", "Kasaragod", "Kollam", "Kottayam", "Kozhikode", "Malappuram", "Palakkad", "Pathanamthitta", "Thiruvananthapuram", "Thrissur", "Wayanad"],
            "Telangana": ["Adilabad", "Bhadradri Kothagudem", "Hyderabad", "Jagtial", "Jangaon", "Jayashankar Bhupalpally", "Jogulamba Gadwal", "Kamareddy", "Karimnagar", "Khammam", "Komaram Bheem", "Mahabubabad", "Mahabubnagar", "Mancherial", "Medak", "Medchal-Malkajgiri", "Mulugu", "Nagarkurnool", "Nalgonda", "Narayanpet", "Nirmal", "Nizamabad", "Peddapalli", "Rajanna Sircilla", "Rangareddy", "Sangareddy", "Siddipet", "Suryapet", "Vikarabad", "Wanaparthy", "Warangal Rural", "Warangal Urban", "Yadadri Bhuvanagiri"],
            "Madhya Pradesh": ["Agar Malwa", "Alirajpur", "Anuppur", "Ashoknagar", "Balaghat", "Barwani", "Betul", "Bhind", "Bhopal", "Burhanpur", "Chhatarpur", "Chhindwara", "Damoh", "Datia", "Dewas", "Dhar", "Dindori", "Guna", "Gwalior", "Harda", "Hoshangabad", "Indore", "Jabalpur", "Jhabua", "Katni", "Khandwa", "Khargone", "Mandla", "Mandsaur", "Morena", "Narsinghpur", "Neemuch", "Niwari", "Panna", "Raisen", "Rajgarh", "Ratlam", "Rewa", "Sagar", "Satna", "Sehore", "Seoni", "Shahdol", "Shajapur", "Sheopur", "Shivpuri", "Sidhi", "Singrauli", "Tikamgarh", "Ujjain", "Umaria", "Vidisha"],
            "Bihar": ["Araria", "Arwal", "Aurangabad", "Banka", "Begusarai", "Bhagalpur", "Bhojpur", "Buxar", "Darbhanga", "East Champaran", "Gaya", "Gopalganj", "Jamui", "Jehanabad", "Kaimur", "Katihar", "Khagaria", "Kishanganj", "Lakhisarai", "Madhepura", "Madhubani", "Munger", "Muzaffarpur", "Nalanda", "Nawada", "Patna", "Purnia", "Rohtas", "Saharsa", "Samastipur", "Saran", "Sheikhpura", "Sheohar", "Sitamarhi", "Siwan", "Supaul", "Vaishali", "West Champaran"],
            "Odisha": ["Angul", "Balangir", "Balasore", "Bargarh", "Bhadrak", "Boudh", "Cuttack", "Deogarh", "Dhenkanal", "Gajapati", "Ganjam", "Jagatsinghpur", "Jajpur", "Jharsuguda", "Kalahandi", "Kandhamal", "Kendrapara", "Kendujhar", "Khordha", "Koraput", "Malkangiri", "Mayurbhanj", "Nabarangpur", "Nayagarh", "Nuapada", "Puri", "Rayagada", "Sambalpur", "Subarnapur", "Sundergarh"],
            "Jharkhand": ["Bokaro", "Chatra", "Deoghar", "Dhanbad", "Dumka", "East Singhbhum", "Garhwa", "Giridih", "Godda", "Gumla", "Hazaribagh", "Jamtara", "Khunti", "Koderma", "Latehar", "Lohardaga", "Pakur", "Palamu", "Ramgarh", "Ranchi", "Sahebganj", "Seraikela Kharsawan", "Simdega", "West Singhbhum"],
            "Assam": ["Baksa", "Barpeta", "Biswanath", "Bongaigaon", "Cachar", "Charaideo", "Chirang", "Darrang", "Dhemaji", "Dhubri", "Dibrugarh", "Dima Hasao", "Goalpara", "Golaghat", "Hailakandi", "Hojai", "Jorhat", "Kamrup", "Kamrup Metropolitan", "Karbi Anglong", "Karimganj", "Kokrajhar", "Lakhimpur", "Majuli", "Morigaon", "Nagaon", "Nalbari", "Sivasagar", "Sonitpur", "South Salmara-Mankachar", "Tinsukia", "Udalguri", "West Karbi Anglong"],
            "Chhattisgarh": ["Balod", "Baloda Bazar", "Balrampur", "Bastar", "Bemetara", "Bijapur", "Bilaspur", "Dantewada", "Dhamtari", "Durg", "Gariaband", "Gaurela Pendra Marwahi", "Janjgir Champa", "Jashpur", "Kabirdham", "Kanker", "Kondagaon", "Korba", "Koriya", "Mahasamund", "Mungeli", "Narayanpur", "Raigarh", "Raipur", "Rajnandgaon", "Sukma", "Surajpur", "Surguja"],
            "Uttarakhand": ["Almora", "Bageshwar", "Chamoli", "Champawat", "Dehradun", "Haridwar", "Nainital", "Pauri Garhwal", "Pithoragarh", "Rudraprayag", "Tehri Garhwal", "Udham Singh Nagar", "Uttarkashi"],
            "Himachal Pradesh": ["Bilaspur", "Chamba", "Hamirpur", "Kangra", "Kinnaur", "Kullu", "Lahaul and Spiti", "Mandi", "Shimla", "Sirmaur", "Solan", "Una"],
            "Goa": ["North Goa", "South Goa"],
            "Arunachal Pradesh": ["Anjaw", "Changlang", "Dibang Valley", "East Kameng", "East Siang", "Kamle", "Kra Daadi", "Kurung Kumey", "Lepa Rada", "Lohit", "Longding", "Lower Dibang Valley", "Lower Siang", "Lower Subansiri", "Namsai", "Pakke Kessang", "Papum Pare", "Shi Yomi", "Siang", "Tawang", "Tirap", "Upper Siang", "Upper Subansiri", "West Kameng", "West Siang"],
            "Manipur": ["Bishnupur", "Chandel", "Churachandpur", "Imphal East", "Imphal West", "Jiribam", "Kakching", "Kamjong", "Kangpokpi", "Noney", "Pherzawl", "Senapati", "Tamenglong", "Tengnoupal", "Thoubal", "Ukhrul"],
            "Meghalaya": ["East Garo Hills", "East Jaintia Hills", "East Khasi Hills", "North Garo Hills", "Ri Bhoi", "South Garo Hills", "South West Garo Hills", "South West Khasi Hills", "West Garo Hills", "West Jaintia Hills", "West Khasi Hills"],
            "Mizoram": ["Aizawl", "Champhai", "Hnahthial", "Khawzawl", "Kolasib", "Lawngtlai", "Lunglei", "Mamit", "Saiha", "Saitual", "Serchhip"],
            "Nagaland": ["Dimapur", "Kiphire", "Kohima", "Longleng", "Mokokchung", "Mon", "Noklak", "Peren", "Phek", "Tuensang", "Wokha", "Zunheboto"],
            "Sikkim": ["East Sikkim", "North Sikkim", "South Sikkim", "West Sikkim"],
            "Tripura": ["Dhalai", "Gomati", "Khowai", "North Tripura", "Sepahijala", "South Tripura", "Unakoti", "West Tripura"],

            // Union Territories
            "Andaman and Nicobar Islands": ["Nicobar", "North and Middle Andaman", "South Andaman", "South Nicobar"],
            "Chandigarh": ["Chandigarh"],
            "Dadra and Nagar Haveli and Daman and Diu": ["Dadra and Nagar Haveli", "Daman", "Diu"],
            "Lakshadweep": ["Lakshadweep"],
            "Puducherry": ["Puducherry", "Karaikal", "Mahe", "Yanam"],

            // UT since 2019
            "Jammu and Kashmir": ["Jammu", "Samba", "Kathua", "Udhampur", "Reasi", "Rajouri", "Poonch", "Doda", "Kishtwar", "Ramban", "Anantnag", "Bandipora", "Baramulla", "Budgam", "Ganderbal", "Kulgam", "Kupwara", "Pulwama", "Shopian", "Srinagar"],
            "Ladakh": ["Leh", "Kargil"]
        };

        // Back-compat: if any old links still pass Jammu/Kashmir separately
        try {
            stateToDistricts['Jammu'] = stateToDistricts['Jammu and Kashmir'];
            stateToDistricts['Kashmir'] = stateToDistricts['Jammu and Kashmir'];
        } catch (e) { /* no-op */ }

        // ===== Progress Bar Management =====
        function updateProgressBar(activeStep) {
            const steps = document.querySelectorAll('.step');
            const progressLine = document.getElementById('stepLineProgress');
            const stepTip = document.getElementById('stepTip');
            
            steps.forEach((step, index) => {
                const stepNum = index + 1;
                step.classList.remove('active', 'completed');
                
                if (stepNum < activeStep) {
                    step.classList.add('completed');
                    const circle = step.querySelector('.step-circle');
                    // Step 1 (Vehicle Category): show selected category icon
                    if (stepNum === 1 && window.__selectedVehicleCategoryIcon) {
                        circle.innerHTML = `<img src="${window.__selectedVehicleCategoryIcon}" alt="Selected category icon" class="vehicle-type-step-icon">`;
                    // Step 2 (Vehicle Type): show selected vehicle icon
                    } else if (stepNum === 2 && window.__selectedVehicleTypeIcon) {
                        circle.innerHTML = `<img src="${window.__selectedVehicleTypeIcon}" alt="Selected vehicle icon" class="vehicle-type-step-icon">`;
                    } else {
                        circle.innerHTML = '<i class="fas fa-check"></i>';
                    }
                } else if (stepNum === activeStep) {
                    step.classList.add('active');
                } else {
                    // Reset future steps
                    const circle = step.querySelector('.step-circle');
                    const icons = ['fa-layer-group', 'fa-truck', 'fa-map-marked-alt', 'fa-city', 'fa-map-pin', 'fa-search'];
                    circle.innerHTML = `<i class="fas ${icons[index]}"></i>`;
                }
            });
            
            // Update progress line width
            const progress = ((activeStep - 1) / (steps.length - 1)) * 100;
            if (progressLine) {
                progressLine.style.width = progress + '%';
                // Set color per step (red→orange→yellow→lightgreen→green)
                const colors = ['#e53935','#e67e22','#f1c40f','#f1c40f','#9ccc65','#2ecc71'];
                progressLine.style.background = colors[Math.max(0, Math.min(activeStep-1, colors.length-1))];
            }

            // Dynamic tip text shown under the title
            if (stepTip) {
                const tips = {
                    1: 'Choose a vehicle category first',
                    2: 'Now select the specific vehicle type',
                    3: 'Now choose your state',
                    4: 'Great! Pick a district in that state',
                    5: 'Select your pincode or use GPS',
                    6: 'All set — click Search to view vehicles nearby'
                };
                stepTip.textContent = tips[activeStep] || '';
            }
        }

        // ===== Form Element References =====
    const vehicleCategorySelect = document.getElementById('vehicleCategory');
    const vehicleTypeSelect = document.getElementById('vehicleType');
        const stateSelect = document.getElementById('state');
        const districtSelect = document.getElementById('district');
    const pincodeInput = document.getElementById('pincode');
    const pincodeSuggestions = document.getElementById('pincodeSuggestions');
    const pincodeChevron = document.getElementById('pincodeChevron');
    const pinVerifiedTick = document.getElementById('pinVerifiedTick');
        const detectLocationBtn = document.getElementById('detectLocationBtn');
        const searchForm = document.getElementById('vehicleSearchForm');

    // Cache all vehicle type optgroups so we can rebuild per category
    const __allVehicleTypeOptgroups = (vehicleTypeSelect)
        ? Array.from(vehicleTypeSelect.querySelectorAll('optgroup')).map(g => g.cloneNode(true))
        : [];

    function rebuildVehicleTypesForCategory(category, keepSelectedValue) {
        if (!vehicleTypeSelect) return;
        const wanted = (keepSelectedValue === undefined) ? (vehicleTypeSelect.value || '') : (keepSelectedValue || '');
        vehicleTypeSelect.innerHTML = '<option value="">Select Vehicle Type</option>';
        if (!category) {
            vehicleTypeSelect.value = '';
            return;
        }
        __allVehicleTypeOptgroups
            .filter(g => (g.getAttribute('data-category') || '').toLowerCase() === String(category).toLowerCase())
            .forEach(g => vehicleTypeSelect.appendChild(g.cloneNode(true)));
        if (wanted) {
            vehicleTypeSelect.value = wanted;
            if (vehicleTypeSelect.value !== wanted) vehicleTypeSelect.value = '';
        }
    }

    // Initialize progress bar
        updateProgressBar(1);

    // Category icon map (used for progress step 1)
    const vehicleCategoryIconMap = {
        goods: 'attached_assets/images/goods-vehicles.webp',
        passenger: 'attached_assets/images/passenger-vehicles.webp',
        rental: 'attached_assets/images/rent-vehicles.webp'
    };

    // Category cards: set select value + keep active state in sync
    const categoryCards = Array.from(document.querySelectorAll('.vehicle-category-card'));
    function setActiveCategoryCard(value) {
        const v = String(value || '').toLowerCase();
        categoryCards.forEach(card => {
            const match = (String(card.getAttribute('data-category-value') || '').toLowerCase() === v);
            card.classList.toggle('active', match);
            card.setAttribute('aria-pressed', match ? 'true' : 'false');
        });

        window.__selectedVehicleCategoryIcon = vehicleCategoryIconMap[v] || null;
    }
    function chooseCategoryFromCard(card) {
        if (!vehicleCategorySelect || !card) return;
        const val = card.getAttribute('data-category-value') || '';
        vehicleCategorySelect.value = val;
        vehicleCategorySelect.dispatchEvent(new Event('change'));
        setActiveCategoryCard(val);
    }
    categoryCards.forEach(card => {
        card.addEventListener('click', () => chooseCategoryFromCard(card));
        card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                chooseCategoryFromCard(card);
            }
        });
    });
    if (vehicleCategorySelect) {
        vehicleCategorySelect.addEventListener('change', () => setActiveCategoryCard(vehicleCategorySelect.value));
        setActiveCategoryCard(vehicleCategorySelect.value);
    }

    // Disable type until category is chosen; disable state/pincode until type is chosen
    if (vehicleTypeSelect) vehicleTypeSelect.disabled = !(vehicleCategorySelect && vehicleCategorySelect.value);
    if (stateSelect) stateSelect.disabled = !vehicleTypeSelect.value;
    if (pincodeInput) pincodeInput.disabled = !vehicleTypeSelect.value;

        // If URL contains a city (from homepage deep link), prefill district select with a temporary option
        (function(){
            try {
                const params = new URLSearchParams(window.location.search);
                const preCity = params.get('city');
                if (preCity && districtSelect) {
                    // mark flag to allow district interaction before state
                    window._prefilledDistrict = true;
                    districtSelect.disabled = false;
                    // add a temp option if missing
                    const has = Array.from(districtSelect.options).some(o => (o.value||'').toLowerCase() === preCity.toLowerCase());
                    if (!has) {
                        const opt = document.createElement('option');
                        opt.value = preCity;
                        opt.textContent = preCity + ' (from homepage)';
                        opt.setAttribute('data-prefill','1');
                        districtSelect.appendChild(opt);
                    }
                    districtSelect.value = preCity;
                    // progress: if type chosen -> District step, else State/Type depending on what exists
                    updateProgressBar(vehicleTypeSelect && vehicleTypeSelect.value ? 4 : ((vehicleCategorySelect && vehicleCategorySelect.value) ? 3 : 2));
                }
            } catch(e) { /* no-op */ }
        })();

        // Mapping of vehicle types to icon URLs (from homepage navbar dropdown)
        const vehicleTypeIconMap = {
            // Small Commercial Vehicles (SCV)
            'Manual Cart (Thel / Rickshaw)': 'attached_assets/images/manual cart (thela).webp',
            'Auto Loader (CNG loader)': 'attached_assets/images/Auto Loader(CNG loader).webp',
            'Tata Ace (Chhota Hathi)': 'attached_assets/images/Auto Loader(CNG loader).webp',
            'E-Rickshaw Loader (Tuk-Tuk)': 'attached_assets/images/e-ricksahw (tuk-tuk).webp',
            
            // Light Commercial Vehicles (LCV)
            'Mini Truck (Eicher Canter)': 'attached_assets/images/mini truck (Eicher Canter).webp',
            'Vikram Tempo': 'attached_assets/images/vikram tempo.webp',
            'Bolero Pickup (MaXX)': 'attached_assets/images/bolero pickup-truck.webp',
            'Tata 407': 'attached_assets/images/tata 407.webp',
            '6 wheeler': 'attached_assets/images/6 wheeler.webp',
            
            // Medium & Heavy Commercial Vehicles (MHCV & HCV)
            'Container Truck': 'attached_assets/images/container truck.webp',
            'Open Body Truck (6 wheeler)': 'attached_assets/images/open body truck.webp',
            'Closed Body Truck': 'attached_assets/images/closed body truck.webp',
            'Flatbed Truck': 'attached_assets/images/flat-bed-truck.webp',
            '8 wheeler': 'attached_assets/images/8 wheeler.webp',
            '12 wheeler and onwards': 'attached_assets/images/12 wheeler and onwards.webp',
            
            // Special Utility Vehicles
            'JCB': 'attached_assets/images/jcb.svg',
            'Crane': 'attached_assets/images/crane.svg',
            'Trailer Truck': 'attached_assets/images/truck-trailer.svg',
            'Tipper Truck (Dumper Truck)': 'attached_assets/images/tipper truck.webp',
            'Tanker Truck': 'attached_assets/images/tanker-truck.webp',
            'Garbage Truck': 'attached_assets/images/garbage-truck.webp',
            
            // Emergency Vehicles
            'Ambulance': 'attached_assets/images/ambulace.webp',
            'Tow-Truck': 'attached_assets/images/Tow-truck.webp',
            
            // Refrigerated & AC Vehicles
            'Refrigerated Vans': 'attached_assets/images/refrigerator vans.webp',
            'Refrigerated Trucks': 'attached_assets/images/refrigerated trucks.webp',
            
            // Service-Based Vehicles
            'Packer&Movers': 'attached_assets/images/Packers.webp',
            'Parcel Delivery': 'attached_assets/images/delivery-man.webp',
            
            // Food & Beverage Vehicles
            'Food trucks': 'attached_assets/images/food-truck.webp',
            'Beverage trucks': 'attached_assets/images/drink-truck.webp',
            
            // Local & Long-Distance Cabs
            'Innova Crysta': 'attached_assets/images/crysta.webp',
            'Ertiga': 'attached_assets/images/ertiga.webp',
            'Dzire': 'attached_assets/images/dzire.webp',
            'Sedan (Verna, Ciaz, etc.)': 'attached_assets/images/sedan.webp',
            'Hatchback (WagonR, i10, etc.)': 'attached_assets/images/hatch-back.webp',
            'Other Taxi Cars': 'attached_assets/images/other-taxis.webp',
            
            // Tourist & Contract Buses
            '26-seater Mini Bus': 'attached_assets/images/mini-bus.webp',
            '35-seater AC Bus': 'attached_assets/images/A.C-bus.webp',
            '45+ Seater Tourist Coach': 'attached_assets/images/45+seaterbuses.webp',
            'Volvo Type Bus': 'attached_assets/images/volvo-bus.webp',
            'Other Bus Types': 'attached_assets/images/other-bus-types.webp',
            
            // Wedding & VIP Rentals
            'Fortuner': 'attached_assets/images/fortuner.webp',
            'Audi/BMW/Mercedes': 'attached_assets/images/audi-bmw-mercedes.webp',
            'Luxury Vintage Cars': 'attached_assets/images/vintage-car.webp',
            'Open Jeep (Decorated)': 'attached_assets/images/open-jeep.webp',
            'SUV/MUV for Baraat': 'attached_assets/images/For-baraat.webp',
            'Other Rental Vehicles': 'attached_assets/images/other-rental-vehicles.webp'
        };

        // If vehicle type is prefilled (e.g., via URL), mark steps completed and enable state
        setTimeout(() => {
            // If category is already set (e.g., via URL), enable type and filter the list
            if (vehicleCategorySelect && vehicleCategorySelect.value) {
                window.__selectedVehicleCategoryIcon = vehicleCategoryIconMap[String(vehicleCategorySelect.value || '').toLowerCase()] || null;
                if (vehicleTypeSelect) vehicleTypeSelect.disabled = false;
                rebuildVehicleTypesForCategory(vehicleCategorySelect.value, vehicleTypeSelect ? vehicleTypeSelect.value : '');
                updateProgressBar(2);
            }
            if (vehicleTypeSelect && vehicleTypeSelect.value) {
                if (stateSelect) stateSelect.disabled = false;
                if (pincodeInput) { pincodeInput.disabled = false; pincodeInput.placeholder = stateSelect && stateSelect.value ? 'Select Pincode' : 'Enter pincode'; }
                // set icon for step 1
                window.__selectedVehicleTypeIcon = vehicleTypeIconMap[vehicleTypeSelect.value] || null;
                updateProgressBar(3);
            }
        }, 300);

        // ===== Step 1: Vehicle Category Selection =====
        if (vehicleCategorySelect) {
            vehicleCategorySelect.addEventListener('change', function() {
                const selectedCategory = this.value;
                window.__selectedVehicleCategoryIcon = vehicleCategoryIconMap[String(selectedCategory || '').toLowerCase()] || null;
                // Reset type and downstream selections
                if (vehicleTypeSelect) {
                    vehicleTypeSelect.disabled = !selectedCategory;
                    rebuildVehicleTypesForCategory(selectedCategory, '');
                }
                window.__selectedVehicleTypeIcon = null;
                if (stateSelect) stateSelect.disabled = true;
                if (districtSelect) { districtSelect.disabled = true; districtSelect.innerHTML = '<option value="">Select District</option>'; }
                if (pincodeInput) { pincodeInput.value = ''; pincodeInput.disabled = true; pincodeInput.placeholder = 'Enter pincode'; }
                if (pincodeSuggestions) pincodeSuggestions.innerHTML = '';
                updateProgressBar(selectedCategory ? 2 : 1);
            });
        }

        // ===== Step 2: Vehicle Type Selection =====
        if (vehicleTypeSelect) {
            vehicleTypeSelect.addEventListener('change', function() {
                if (this.value) {
                    // Update selected icon for step 1
                    window.__selectedVehicleTypeIcon = vehicleTypeIconMap[this.value] || null;
                    if (stateSelect) stateSelect.disabled = false;
                    if (pincodeInput) { pincodeInput.disabled = false; pincodeInput.placeholder = stateSelect && stateSelect.value ? 'Select Pincode' : 'Enter pincode'; }
                    updateProgressBar(3);
                } else {
                    window.__selectedVehicleTypeIcon = null;
                    if (stateSelect) stateSelect.disabled = true;
                    if (districtSelect) { districtSelect.disabled = true; districtSelect.innerHTML = '<option value="">Select District</option>'; }
                    if (pincodeInput) { pincodeInput.value = ''; pincodeInput.disabled = true; pincodeInput.placeholder = 'Enter pincode'; }
                    if (pincodeSuggestions) pincodeSuggestions.innerHTML = '';
                    updateProgressBar(vehicleCategorySelect && vehicleCategorySelect.value ? 2 : 1);
                }
            });

            // Guard: category must be selected before type
            const guardTypeBeforeCategory = (e) => {
                if (vehicleCategorySelect && vehicleCategorySelect.value) return;
                e.preventDefault();
                e.stopImmediatePropagation();
                triggerShake(vehicleCategorySelect);
                showToast('Please select vehicle category first', 'error');
            };
            vehicleTypeSelect.addEventListener('mousedown', guardTypeBeforeCategory);
            vehicleTypeSelect.addEventListener('click', guardTypeBeforeCategory);
            vehicleTypeSelect.addEventListener('pointerdown', guardTypeBeforeCategory);
        }

        // Guarded focus handlers to guide order with shake feedback
    if (stateSelect) stateSelect.addEventListener('focus', function(){ if(!vehicleTypeSelect.value) triggerShake(vehicleTypeSelect); });
    if (districtSelect) districtSelect.addEventListener('focus', function(){ if(!stateSelect.value) triggerShake(stateSelect); });
    // Do not block pincode by focus; user may enter it first

        // ===== Step 3: State Selection → Enable District =====
        if (stateSelect && districtSelect) {
            stateSelect.addEventListener('change', function() {
                if (!vehicleTypeSelect.value) {
                    triggerShake(vehicleTypeSelect);
                    return;
                }
                const selectedState = this.value;
                
                // Reset district and pincode
                districtSelect.innerHTML = '<option value="">Select District</option>';
                if (pincodeSuggestions) pincodeSuggestions.innerHTML = '';
                districtSelect.disabled = true;
                if (pincodeInput) {
                    // Do not clear user pincode if it was verified in enter mode
                    if (!window.locationVerified) {
                        pincodeInput.value = '';
                    }
                    // If already verified (e.g., via pincode), keep neutral placeholder and don't suggest selection
                    pincodeInput.placeholder = (window.locationVerified ? 'Enter pincode' : (selectedState ? 'Select Pincode' : 'Enter pincode'));
                }
                
                if (selectedState && stateToDistricts[selectedState]) {
                    // Populate districts for selected state
                    const districts = stateToDistricts[selectedState];
                    districts.forEach(district => {
                        const option = document.createElement('option');
                        option.value = district;
                        option.textContent = district;
                        districtSelect.appendChild(option);
                    });
                    
                    districtSelect.disabled = false;
                    // If pincode verification already succeeded, keep progress at Search
                    updateProgressBar(window.locationVerified ? 6 : 4);
                } else {
                    updateProgressBar(3);
                }
            });
        }

        // ===== Step 4: District Selection → Fetch Pincodes =====
        if (districtSelect && pincodeInput) {
            districtSelect.addEventListener('change', async function() {
                if (!vehicleTypeSelect.value) {
                    triggerShake(vehicleTypeSelect);
                    return;
                }
                if (!stateSelect.value) {
                    triggerShake(stateSelect);
                    return;
                }
                const selectedDistrict = this.value;
                const selectedState = stateSelect.value;
                const normalizeStateKey = (s) => String(s || '')
                    .toLowerCase()
                    .replace(/&/g, ' and ')
                    .replace(/[^a-z0-9]+/g, ' ')
                    .replace(/\s+/g, ' ')
                    .trim();
                const selectedStateKey = normalizeStateKey(selectedState);
                const selectedDistrictKey = normalizeStateKey(selectedDistrict);
                const matchesSelectedState = (officeState) => {
                    const key = normalizeStateKey(officeState);
                    if (!selectedStateKey) return true;
                    if (key === selectedStateKey) return true;
                    if (selectedStateKey === 'delhi' && key === 'nct of delhi') return true;
                    if (selectedStateKey === 'ladakh' && key === 'jammu and kashmir') return true;
                    if (selectedStateKey === 'andaman and nicobar islands' && (key === 'andaman and nicobar' || key === 'andaman nicobar' || key === 'andaman nicobar islands')) return true;
                    if (selectedStateKey === 'puducherry' && key === 'pondicherry') return true;
                    // Puducherry enclaves often appear under neighbouring states in India Post
                    if (selectedStateKey === 'puducherry') {
                        if (selectedDistrictKey === 'mahe' && key === 'kerala') return true;
                        if (selectedDistrictKey === 'yanam' && key === 'andhra pradesh') return true;
                        if (selectedDistrictKey === 'karaikal' && key === 'tamil nadu') return true;
                    }
                    // India Post may still report old UT names for merged UT
                    if (selectedStateKey === 'dadra and nagar haveli and daman and diu' && (key === 'dadra and nagar haveli' || key === 'daman and diu')) return true;
                    return false;
                };

                const isUnionTerritory = (s) => {
                    const k = normalizeStateKey(s);
                    return [
                        'andaman and nicobar islands',
                        'chandigarh',
                        'dadra and nagar haveli and daman and diu',
                        'delhi',
                        'jammu and kashmir',
                        'ladakh',
                        'lakshadweep',
                        'puducherry'
                    ].includes(k);
                };

                const getIndiaPostOffices = async (q) => {
                    try {
                        const resp = await fetch(`https://api.postalpincode.in/postoffice/${encodeURIComponent(q)}`);
                        const json = await resp.json();
                        return (json && json[0] && json[0].Status === 'Success') ? (json[0].PostOffice || []) : [];
                    } catch (e) {
                        return [];
                    }
                };

                const stateSearchAlias = (s, district) => {
                    const k = normalizeStateKey(s);
                    const d = normalizeStateKey(district);
                    if (k === 'andaman and nicobar islands') return 'Andaman';
                    if (k === 'puducherry') {
                        // India Post commonly uses old name "Pondicherry"
                        if (d === 'puducherry') return 'Pondicherry';
                        return district || 'Pondicherry';
                    }
                    if (k === 'lakshadweep') {
                        // Searching "Lakshadweep" returns Error; island/capital names work
                        return 'Kavaratti';
                    }
                    if (k === 'dadra and nagar haveli and daman and diu') {
                        if (d.includes('daman')) return 'Daman';
                        if (d.includes('diu')) return 'Diu';
                        // Dadra & Nagar Haveli: Silvassa/Dadra search works
                        return 'Silvassa';
                    }
                    if (k === 'ladakh') return 'Leh';
                    if (k === 'delhi') return 'Delhi';
                    if (k === 'jammu and kashmir') return 'Kashmir';
                    return s;
                };

                const buildPincodeListFromOffices = (offices, district) => {
                    const dKey = normalizeStateKey(district);
                    const stateKey = normalizeStateKey(selectedState);
                    const districtAliases = new Set([dKey]);
                    // District naming variants seen in India Post
                    if (stateKey === 'puducherry' && dKey === 'puducherry') districtAliases.add('pondicherry');
                    if (stateKey === 'andaman and nicobar islands' && dKey === 'north and middle andaman') districtAliases.add('north middle andaman');
                    if (stateKey === 'andaman and nicobar islands' && dKey === 'south nicobar') districtAliases.add('nicobar');
                    if (stateKey === 'dadra and nagar haveli and daman and diu' && dKey === 'dadra and nagar haveli') {
                        districtAliases.add('dadra nagar haveli');
                        districtAliases.add('dadra & nagar haveli');
                    }
                    const filtered = offices
                        .filter(o => !selectedState || matchesSelectedState(o.State))
                        .filter(o => {
                            if (!district) return true;
                            const od = normalizeStateKey(o.District || o.Division || o.Region || '');
                            return districtAliases.has(od);
                        });
                    const unique = new Map();
                    filtered.forEach(o => { if (o && o.Pincode) unique.set(o.Pincode, o); });
                    return Array.from(unique.values());
                };
                
                // Reset pincode
                if (pincodeSuggestions) { pincodeSuggestions.innerHTML = ''; pincodeSuggestions.style.display = 'none'; }
                if (pincodeInput) { pincodeInput.placeholder = window.locationVerified ? 'Enter pincode' : 'Loading pincodes...'; }
                // If pincode already verified, do not fetch suggestions or show chevron
                if (window.locationVerified) {
                    if (pincodeChevron) pincodeChevron.style.display = 'none';
                    return;
                }

                // Puducherry UT: use local lists only (no API)
                const puducherryLocal = {
                    'Puducherry': [
                        { pincode: '605001', postOfficeName: 'Puducherry HO' },
                        { pincode: '605007', postOfficeName: 'Ariyankuppam' },
                        { pincode: '605110', postOfficeName: 'Villianur' },
                        { pincode: '605008', postOfficeName: 'Lawspet' },
                        { pincode: '605014', postOfficeName: 'Pondicherry University' }
                    ],
                    'Karaikal': [
                        { pincode: '609602', postOfficeName: 'Karaikal HO' }
                    ],
                    'Mahe': [
                        { pincode: '673310', postOfficeName: 'Mahe HO' }
                    ],
                    'Yanam': [
                        { pincode: '533464', postOfficeName: 'Yanam HO' }
                    ]
                };
                if (selectedStateKey === 'puducherry') {
                    const localList = puducherryLocal[selectedDistrict] || [];
                    if (localList.length) {
                        if (pincodeSuggestions) {
                            pincodeSuggestions.innerHTML = '';
                            localList.forEach(p => {
                                const item = document.createElement('div');
                                item.className = 'pin-suggestion-item';
                                item.innerHTML = `<div class="pin-suggestion-code">${p.pincode}</div><div class="pin-suggestion-name">${p.postOfficeName || ''}</div>`;
                                item.addEventListener('click', () => {
                                    pincodeInput.value = p.pincode;
                                    window.locationVerified = true;
                                    if (pincodeChevron) pincodeChevron.style.display = 'none';
                                    if (pincodeInput) {
                                        pincodeInput.classList.add('pin-verified');
                                        pincodeInput.style.borderColor = '#10b981';
                                        pincodeInput.style.boxShadow = '0 0 0 4px rgba(16,185,129,0.15)';
                                    }
                                    pincodeSuggestions.style.display = 'none';
                                    pincodeInput.placeholder = 'Enter pincode';
                                    pincodeInput.dispatchEvent(new Event('input'));
                                });
                                pincodeSuggestions.appendChild(item);
                            });
                            if (pincodeChevron) pincodeChevron.style.display = 'inline-flex';
                        }
                        if (pincodeInput) { pincodeInput.placeholder = 'Select Pincode'; }
                        updateProgressBar(4);
                    } else {
                        if (pincodeInput) { pincodeInput.placeholder = 'Enter pincode manually'; }
                        if (pincodeChevron) pincodeChevron.style.display = 'none';
                    }
                    return;
                }
                
                if (selectedDistrict) {
                    try {
                        // Call backend API to get pincodes for the district
                        const apiBase = (window.API_BASE_URL || '').replace(/\/$/, '');
                        let ok = false;
                        if (apiBase) {
                            try {
                                const response = await fetch(`${apiBase}/api/geo/pincodes?district=${encodeURIComponent(selectedDistrict)}&state=${encodeURIComponent(selectedState)}`);
                                if (response.ok) {
                                    const data = await response.json();
                                    if (data && Array.isArray(data.pincodes) && data.pincodes.length) {
                                        if (pincodeSuggestions) {
                                            pincodeSuggestions.innerHTML = '';
                                            data.pincodes.forEach(p => {
                                                const item = document.createElement('div');
                                                item.className = 'pin-suggestion-item';
                                                item.innerHTML = `<div class="pin-suggestion-code">${p.pincode}</div><div class="pin-suggestion-name">${p.postOfficeName || ''}</div>`;
                                                item.addEventListener('click', () => {
                                                    pincodeInput.value = p.pincode;
                                                    window.locationVerified = true;
                                                    if (pincodeChevron) pincodeChevron.style.display = 'none';
                                                    // mark input verified (green border)
                                                    if (pincodeInput) {
                                                        pincodeInput.classList.add('pin-verified');
                                                        // Apply inline styles as fallback to guarantee visibility
                                                        pincodeInput.style.borderColor = '#10b981';
                                                        pincodeInput.style.boxShadow = '0 0 0 4px rgba(16,185,129,0.15)';
                                                    }
                                                    pincodeSuggestions.style.display = 'none';
                                                    pincodeInput.placeholder = 'Enter pincode';
                                                    pincodeInput.dispatchEvent(new Event('input'));
                                                });
                                                pincodeSuggestions.appendChild(item);
                                            });
                                            // Do not auto-open; show chevron so user opens
                                            if (pincodeChevron) pincodeChevron.style.display = 'inline-flex';
                                        }
                                        if (pincodeInput) { pincodeInput.placeholder = 'Select Pincode'; }
                                        updateProgressBar(4);
                                        ok = true;
                                    }
                                }
                            } catch (e) {
                                // fallthrough to frontend fallback
                            }
                        }

                        // Fallback: call India Post API directly from browser (CORS-enabled)
                        if (!ok) {
                            // 1) Try searching by district name
                            let offices = await getIndiaPostOffices(selectedDistrict);
                            let list = buildPincodeListFromOffices(offices, selectedDistrict);

                            // 2) If empty (common for UT districts), try searching by state alias and filter by district
                            if (!list.length && isUnionTerritory(selectedState)) {
                                // Special: Lakshadweep needs multiple island queries to get all pincodes
                                if (normalizeStateKey(selectedState) === 'lakshadweep') {
                                    const queries = ['Kavaratti', 'Agatti', 'Amini', 'Minicoy', 'Andrott', 'Kalpeni', 'Kadmat', 'Kiltan', 'Chetlat', 'Bitra'];
                                    const all = [];
                                    for (const q of queries) {
                                        const part = await getIndiaPostOffices(q);
                                        if (part && part.length) all.push(...part);
                                    }
                                    list = buildPincodeListFromOffices(all, selectedDistrict);
                                } else {
                                    offices = await getIndiaPostOffices(stateSearchAlias(selectedState, selectedDistrict));
                                    list = buildPincodeListFromOffices(offices, selectedDistrict);
                                }
                            }

                            if (list.length) {
                                if (pincodeSuggestions) {
                                    pincodeSuggestions.innerHTML = '';
                                    list.forEach(o => {
                                        const item = document.createElement('div');
                                        item.className = 'pin-suggestion-item';
                                        item.innerHTML = `<div class="pin-suggestion-code">${o.Pincode}</div><div class="pin-suggestion-name">${o.Name || ''}</div>`;
                                        item.addEventListener('click', () => {
                                            pincodeInput.value = o.Pincode;
                                            window.locationVerified = true;
                                            if (pincodeChevron) pincodeChevron.style.display = 'none';
                                            if (pincodeInput) {
                                                pincodeInput.classList.add('pin-verified');
                                                pincodeInput.style.borderColor = '#10b981';
                                                pincodeInput.style.boxShadow = '0 0 0 4px rgba(16,185,129,0.15)';
                                            }
                                            pincodeSuggestions.style.display = 'none';
                                            pincodeInput.placeholder = 'Enter pincode';
                                            pincodeInput.dispatchEvent(new Event('input'));
                                        });
                                        pincodeSuggestions.appendChild(item);
                                    });
                                    // Do not auto-open; show chevron so user opens
                                    if (pincodeChevron) pincodeChevron.style.display = 'inline-flex';
                                }
                                if (pincodeInput) { pincodeInput.placeholder = 'Select Pincode'; }
                                updateProgressBar(4);
                            } else {
                                // Final fallback for Puducherry enclaves where India Post doesn't expose district lists reliably
                                const stKey = normalizeStateKey(selectedState);
                                const distKey = normalizeStateKey(selectedDistrict);
                                if (stKey === 'puducherry' && (distKey === 'mahe' || distKey === 'yanam')) {
                                    const fallbackPins = (distKey === 'mahe')
                                        ? [{ Pincode: '673310', Name: 'Mahe' }]
                                        : [{ Pincode: '533464', Name: 'Yanam' }];
                                    if (pincodeSuggestions) {
                                        pincodeSuggestions.innerHTML = '';
                                        fallbackPins.forEach(o => {
                                            const item = document.createElement('div');
                                            item.className = 'pin-suggestion-item';
                                            item.innerHTML = `<div class="pin-suggestion-code">${o.Pincode}</div><div class="pin-suggestion-name">${o.Name || ''}</div>`;
                                            item.addEventListener('click', () => {
                                                pincodeInput.value = o.Pincode;
                                                window.locationVerified = true;
                                                if (pincodeChevron) pincodeChevron.style.display = 'none';
                                                if (pincodeInput) {
                                                    pincodeInput.classList.add('pin-verified');
                                                    pincodeInput.style.borderColor = '#10b981';
                                                    pincodeInput.style.boxShadow = '0 0 0 4px rgba(16,185,129,0.15)';
                                                }
                                                pincodeSuggestions.style.display = 'none';
                                                pincodeInput.placeholder = 'Enter pincode';
                                                pincodeInput.dispatchEvent(new Event('input'));
                                            });
                                            pincodeSuggestions.appendChild(item);
                                        });
                                        if (pincodeChevron) pincodeChevron.style.display = 'inline-flex';
                                    }
                                    if (pincodeInput) { pincodeInput.placeholder = 'Select Pincode'; }
                                    updateProgressBar(4);
                                } else {
                                if (pincodeInput) { pincodeInput.placeholder = 'Enter pincode manually'; }
                                }
                            }
                        }
                    } catch (error) {
                        console.error('Error fetching pincodes:', error);
                        if (pincodeInput) { pincodeInput.placeholder = 'Error loading; enter pincode manually'; }
                    }
                } else {
                    if (pincodeSuggestions) { pincodeSuggestions.innerHTML = ''; pincodeSuggestions.style.display = 'none'; }
                    if (pincodeInput) { pincodeInput.value = ''; pincodeInput.placeholder = 'Select Pincode'; }
                    if (pincodeChevron) pincodeChevron.style.display = 'none';
                    updateProgressBar(3);
                }
            });
        }

        // ===== Step 4: Pincode Entry/Selection =====
        if (pincodeInput) {
            let pinLookupTimer = null;
            let lastLookupPin = '';
            let inFlightVerifyPromise = null;
            const normalizeStateKey = (s) => String(s || '')
                .toLowerCase()
                .replace(/&/g, ' and ')
                .replace(/[^a-z0-9]+/g, ' ')
                .replace(/\s+/g, ' ')
                .trim();

            const setStateTolerant = (rawState) => {
                if (!stateSelect) return;
                const wanted = String(rawState || '').trim();
                if (!wanted) return;
                // exact
                for (let i = 0; i < stateSelect.options.length; i++) {
                    if (stateSelect.options[i].value === wanted) {
                        stateSelect.selectedIndex = i;
                        return;
                    }
                }
                const key = normalizeStateKey(wanted);
                const aliases = new Set([key]);
                if (key === 'delhi') aliases.add('nct of delhi');
                if (key === 'andaman and nicobar islands') { aliases.add('andaman and nicobar'); aliases.add('andaman nicobar'); aliases.add('andaman nicobar islands'); }
                if (key === 'puducherry') aliases.add('pondicherry');
                if (key === 'dadra and nagar haveli and daman and diu') { aliases.add('dadra and nagar haveli'); aliases.add('daman and diu'); }
                if (key === 'ladakh') aliases.add('jammu and kashmir');
                for (let i = 0; i < stateSelect.options.length; i++) {
                    const ok = normalizeStateKey(stateSelect.options[i].value);
                    if (aliases.has(ok)) {
                        stateSelect.selectedIndex = i;
                        return;
                    }
                }
            };

            const ensureDistrictSelected = (rawDistrict) => {
                if (!districtSelect) return;
                const wanted = String(rawDistrict || '').trim();
                if (!wanted) return;
                // if district list is empty/disabled, state change will populate it
                districtSelect.disabled = false;
                const existing = Array.from(districtSelect.options).some(o => (o.value || '').toLowerCase() === wanted.toLowerCase());
                if (!existing) {
                    const opt = document.createElement('option');
                    opt.value = wanted;
                    opt.textContent = wanted;
                    districtSelect.appendChild(opt);
                }
                districtSelect.value = wanted;
            };

            const verifyPinAndAutofill = async (pin) => {
                try {
                    // Puducherry UT: local-only pin mapping (no API)
                    const puducherryPinToDistrict = {
                        '605001': 'Puducherry',
                        '605007': 'Puducherry',
                        '605110': 'Puducherry',
                        '605008': 'Puducherry',
                        '605014': 'Puducherry',
                        '609602': 'Karaikal',
                        '673310': 'Mahe',
                        '533464': 'Yanam'
                    };
                    const localDistrict = puducherryPinToDistrict[String(pin || '').trim()];
                    if (localDistrict) {
                        // Mark verified before triggering state/district change events so progress doesn't regress
                        window.locationVerified = true;
                        if (stateSelect) {
                            setStateTolerant('Puducherry');
                            stateSelect.dispatchEvent(new Event('change'));
                        }
                        setTimeout(() => {
                            ensureDistrictSelected(localDistrict);
                            try { districtSelect.dispatchEvent(new Event('change')); } catch (e) { /* no-op */ }
                        }, 200);

                        if (pincodeChevron) pincodeChevron.style.display = 'none';
                        if (pincodeSuggestions) pincodeSuggestions.style.display = 'none';
                        if (pincodeInput) {
                            pincodeInput.classList.add('pin-verified');
                            pincodeInput.style.borderColor = '#10b981';
                            pincodeInput.style.boxShadow = '0 0 0 4px rgba(16,185,129,0.15)';
                            pincodeInput.placeholder = 'Enter pincode';
                        }
                        return true;
                    }

                    const resp = await fetch(`https://api.postalpincode.in/pincode/${encodeURIComponent(pin)}`);
                    const json = await resp.json();
                    const list = (json && json[0] && json[0].Status === 'Success') ? (json[0].PostOffice || []) : [];
                    if (!list.length) return false;

                    // Choose the most relevant PostOffice entry (the first one is often misleading for enclaves)
                    const pickBestPostOffice = (arr) => {
                        const hasPondicherryMarker = (o) => {
                            const t = [o.Circle, o.Block, o.Taluk, o.District, o.State, o.Region, o.Division, o.Name]
                                .map(x => normalizeStateKey(x)).join(' ');
                            return t.includes('pondicherry') || t.includes('puducherry');
                        };
                        const isMaheByText = (o) => {
                            const t = [o.Name, o.District, o.Block, o.Taluk].map(x => normalizeStateKey(x)).join(' ');
                            return t.includes('mahe');
                        };
                        const score = (o) => {
                            const stateKey = normalizeStateKey(o.State);
                            const distKey = normalizeStateKey(o.District);
                            const nameKey = normalizeStateKey(o.Name);
                            let s = 0;
                            if (stateKey === 'pondicherry' || stateKey === 'puducherry') s += 50;
                            if (distKey === 'mahe' || distKey === 'yanam' || distKey === 'karaikal') s += 25;
                            if (nameKey.includes('mahe') || nameKey.includes('yanam') || nameKey.includes('karaikal')) s += 20;
                            if (hasPondicherryMarker(o)) s += 15;
                            if (isMaheByText(o)) s += 10;
                            return s;
                        };
                        return arr.slice().sort((a,b)=>score(b)-score(a))[0];
                    };

                    const po = pickBestPostOffice(list);
                    let apiState = po.State || po.Circle || '';
                    let apiDistrict = po.District || po.Division || po.Region || '';

                    const dKey = normalizeStateKey(apiDistrict);
                    const sKey = normalizeStateKey(apiState);

                    // Ladakh: India Post sometimes reports State as J&K for Leh/Kargil
                    if (sKey === 'jammu and kashmir' && (dKey === 'leh' || dKey === 'kargil')) {
                        apiState = 'Ladakh';
                    }

                    // Puducherry enclaves:
                    // - Mahe pincode may show District=Kozhikode, State=Kerala, but PO.Name=Mahe / other entries have Pondicherry
                    // - Yanam pincode often shows State=Andhra Pradesh, District=East Godavari, but Circle/Block contains Pondicherry
                    const poText = [po.Circle, po.Block, po.Taluk, po.District, po.State, po.Region, po.Division, po.Name]
                        .map(x => normalizeStateKey(x)).join(' ');
                    const anyHas = (pred) => list.some(pred);
                    const anyNameIncludes = (needle) => anyHas(o => normalizeStateKey(o.Name).includes(needle));
                    const anyDistrictIs = (needle) => anyHas(o => normalizeStateKey(o.District) === needle);
                    const anyMarkerPondicherry = anyHas(o => {
                        const t = [o.Circle, o.Block, o.Taluk, o.District, o.State, o.Region, o.Division, o.Name]
                            .map(x => normalizeStateKey(x)).join(' ');
                        return t.includes('pondicherry') || t.includes('puducherry');
                    });

                    if (anyDistrictIs('mahe') || anyNameIncludes('mahe') || (normalizeStateKey(po.Name).includes('mahe') || poText.includes('mahe'))) {
                        apiState = 'Puducherry';
                        apiDistrict = 'Mahe';
                    } else if (anyMarkerPondicherry && (sKey === 'andhra pradesh' || normalizeStateKey(po.State) === 'andhra pradesh')) {
                        apiState = 'Puducherry';
                        apiDistrict = 'Yanam';
                    } else if (anyMarkerPondicherry && (sKey === 'tamil nadu' || normalizeStateKey(po.State) === 'tamil nadu')) {
                        apiState = 'Puducherry';
                        apiDistrict = 'Karaikal';
                    }

                    // Mark verified before triggering state/district change events so progress doesn't regress
                    window.locationVerified = true;
                    if (stateSelect) {
                        setStateTolerant(apiState);
                        stateSelect.dispatchEvent(new Event('change'));
                    }

                    // wait a tick for districts to populate
                    setTimeout(() => {
                        ensureDistrictSelected(apiDistrict);
                        try { districtSelect.dispatchEvent(new Event('change')); } catch (e) { /* no-op */ }
                    }, 200);

                    if (pincodeChevron) pincodeChevron.style.display = 'none';
                    if (pincodeSuggestions) pincodeSuggestions.style.display = 'none';
                    if (pincodeInput) {
                        pincodeInput.classList.add('pin-verified');
                        pincodeInput.style.borderColor = '#10b981';
                        pincodeInput.style.boxShadow = '0 0 0 4px rgba(16,185,129,0.15)';
                        pincodeInput.placeholder = 'Enter pincode';
                    }
                    return true;
                } catch (e) {
                    return false;
                }
            };

            // Expose verifier so vehicles.js can await it (prevents double-click / overlap)
            try { window.__verifyPinAndAutofill = verifyPinAndAutofill; } catch(_) {}
            try { window.__pincodeVerifyPromise = null; } catch(_) {}

                const onPinChanged = function() {
                // digits only, max 6
                const cleaned = String(pincodeInput.value || '').replace(/[^0-9]/g, '').slice(0, 6);
                if (pincodeInput.value !== cleaned) pincodeInput.value = cleaned;
                const val = cleaned.trim();
                if (/^\d{6}$/.test(val)) {
                    // Pincode step active while verifying
                    updateProgressBar(5);

                    // If already verified, jump the tip to Search step
                    if (window.locationVerified) {
                        updateProgressBar(6);
                        return;
                    }

                    // If user typed a valid pincode, auto-fill state/district (especially helpful for UTs)
                    if (!window.locationVerified && val !== lastLookupPin) {
                        if (pinLookupTimer) { clearTimeout(pinLookupTimer); pinLookupTimer = null; }
                        // Lock to this pin so we don't re-verify repeatedly
                        lastLookupPin = val;
                        // Show toast immediately when 6 digits are entered (better UX)
                        showToast('Verifying pincode... please wait','info');

                        inFlightVerifyPromise = (async () => {
                            const ok = await verifyPinAndAutofill(val);
                            if (ok) {
                                // Verified: mark pincode complete and move to Search
                                updateProgressBar(6);
                            } else {
                                // Stay on pincode step
                                updateProgressBar(5);
                            }
                            return ok;
                        })();
                        try { window.__pincodeVerifyPromise = inFlightVerifyPromise; } catch(_) {}
                    }
                } else {
                    // Not a full pin: revert to pincode step (district completed) and clear verified state
                    updateProgressBar(5);
                    if (pincodeInput) {
                        pincodeInput.classList.remove('pin-verified');
                        pincodeInput.style.borderColor = '';
                        pincodeInput.style.boxShadow = '';
                    }
                    // if user edits pincode, return to manual/unverified mode
                    window.locationVerified = false;
                    // Allow re-verifying the same pincode again after edits
                    lastLookupPin = null;
                    inFlightVerifyPromise = null;
                    try { window.__pincodeVerifyPromise = null; } catch(_) {}
                    if (pincodeChevron) pincodeChevron.style.display = (pincodeSuggestions && pincodeSuggestions.children.length) ? 'inline-flex' : 'none';
                }
            };
            pincodeInput.addEventListener('input', onPinChanged);
            pincodeInput.addEventListener('change', onPinChanged);

            // Show suggestions when input is focused and we have any
            pincodeInput.addEventListener('focus', () => {
                // Don't auto-open. User can toggle with chevron or click input; enforce prerequisites via toggleSuggestions
            });
            pincodeInput.addEventListener('blur', () => {
                setTimeout(()=>{ if (pincodeSuggestions) pincodeSuggestions.style.display = 'none'; }, 150);
            });
            // Toggle by clicking chevron or input click when district selected
            const toggleSuggestions = () => {
                if (window.locationVerified) { return; }
                if (!vehicleTypeSelect.value) { triggerShake(vehicleTypeSelect); showToast('Please select vehicle type first','error'); return; }
                // Only enforce district when trying to open suggestions; user can still type pincode manually
                if (stateSelect.value && !districtSelect.value) { return; }
                if (pincodeSuggestions && pincodeSuggestions.children.length) {
                    pincodeSuggestions.style.display = (pincodeSuggestions.style.display === 'none' || !pincodeSuggestions.style.display) ? 'block' : 'none';
                }
            };
            if (pincodeChevron) pincodeChevron.addEventListener('click', toggleSuggestions);
            // Keep input click usable for manual typing; suggestions can be toggled via chevron
            pincodeInput.addEventListener('click', () => { /* no-op */ });

            // Close suggestions when clicking outside the pincode field/suggestions
            document.addEventListener('mousedown', (e) => {
                try {
                    if (!pincodeSuggestions) return;
                    if (pincodeSuggestions.style.display !== 'block') return;
                    const wrap = pincodeInput.closest('.form-group');
                    if (wrap && wrap.contains(e.target)) return;
                    pincodeSuggestions.style.display = 'none';
                } catch (err) { /* no-op */ }
            }, true);
            // Keyboard navigation for suggestions
            pincodeInput.addEventListener('keydown', (e) => {
                if (!pincodeSuggestions || !pincodeSuggestions.children.length) return;
                const items = Array.from(pincodeSuggestions.children);
                let idx = items.findIndex(x => x.classList.contains('active'));
                if (e.key === 'ArrowDown') { e.preventDefault(); if (idx < items.length-1) idx++; else idx = 0; items.forEach(i=>i.classList.remove('active')); items[idx].classList.add('active'); items[idx].scrollIntoView({block:'nearest'}); }
                if (e.key === 'ArrowUp') { e.preventDefault(); if (idx > 0) idx--; else idx = items.length-1; items.forEach(i=>i.classList.remove('active')); items[idx].classList.add('active'); items[idx].scrollIntoView({block:'nearest'}); }
                if (e.key === 'Enter' && idx >= 0) { e.preventDefault(); items[idx].click(); }
            });
        }

        // ===== GPS Location Detection =====
        if (detectLocationBtn) {
            detectLocationBtn.addEventListener('click', function() {
                if ('geolocation' in navigator) {
                    detectLocationBtn.disabled = true;
                    detectLocationBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Detecting...';
                    
                    navigator.geolocation.getCurrentPosition(
                        async function(position) {
                            const lat = position.coords.latitude;
                            const lon = position.coords.longitude;
                            
                            try {
                                const apiBase = (window.API_BASE_URL || '').replace(/\/$/, '');
                                const response = await fetch(`${apiBase}/api/geo/reverse?lat=${lat}&lon=${lon}`);
                                
                                if (response.ok) {
                                    const data = await response.json();
                                    
                                    if (data.pincode) {
                                        // Set state if available
                                        if (data.state && stateSelect) {
                                            stateSelect.value = data.state;
                                            stateSelect.dispatchEvent(new Event('change'));
                                        }
                                        
                                        // Set district if available
                                        if (data.district && districtSelect) {
                                            setTimeout(() => {
                                                districtSelect.value = data.district;
                                                districtSelect.dispatchEvent(new Event('change'));
                                            }, 500);
                                        }
                                        
                                        // Set pincode (input)
                                        setTimeout(() => {
                                            if (pincodeInput) {
                                                pincodeInput.value = data.pincode;
                                                pincodeInput.dispatchEvent(new Event('input'));
                                            }
                                        }, 900);
                                        
                                        showToast('Location detected successfully!', 'success');
                                    } else {
                                        showToast('Could not detect pincode from your location', 'error');
                                    }
                                } else {
                                    showToast('Error detecting location', 'error');
                                }
                            } catch (error) {
                                console.error('Error in reverse geocoding:', error);
                                showToast('Error detecting location', 'error');
                            } finally {
                                detectLocationBtn.disabled = false;
                                detectLocationBtn.innerHTML = ' Use Location';
                            }
                        },
                        function(error) {
                            console.error('Geolocation error:', error);
                            showToast('Please allow location access', 'error');
                            detectLocationBtn.disabled = false;
                            detectLocationBtn.innerHTML = ' Use Location';
                        }
                    );
                } else {
                    showToast('Geolocation not supported by your browser', 'error');
                }
            });
        }

        // ===== Toast Notification Helper =====
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 30px;
                right: 30px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ===== Form Submission =====
        if (searchForm) {
            searchForm.addEventListener('submit', function(e) {
                if (!(vehicleCategorySelect && vehicleCategorySelect.value)) { e.preventDefault(); e.stopImmediatePropagation(); triggerShake(vehicleCategorySelect); showToast('Please select vehicle category first','error'); return; }
                // Remove the optional vehicle type popup; just shake and block other listeners
                if (!vehicleTypeSelect.value) { e.preventDefault(); e.stopImmediatePropagation(); triggerShake(vehicleTypeSelect); return; }
                const validPin = pincodeInput && /^\d{6}$/.test((pincodeInput.value||'').trim());
                if (validPin) {
                    updateProgressBar(5);
                    // Let vehicles.js handle the actual search
                } else {
                    // If pin not present, enforce state and district path
                    if (!stateSelect.value) { e.preventDefault(); e.stopImmediatePropagation(); triggerShake(stateSelect); showToast('Select state or enter pincode','error'); return; }
                    if (!districtSelect.value) { e.preventDefault(); e.stopImmediatePropagation(); triggerShake(districtSelect); showToast('Select district or enter pincode','error'); return; }
                }
            });
        }

        // ===== Click-to-shake on form-group wrappers =====
        const groupById = (id) => {
            const el = document.getElementById(id);
            return el ? el.closest('.form-group') : null;
        };
        const vcGroup = groupById('vehicleCategory');
        const vtGroup = groupById('vehicleType');
        const stateGroup = groupById('state');
        const distGroup = groupById('district');
        const pinGroup = groupById('pincode');
        const safeToast = (msg,type) => { if (window.showToast) window.showToast(msg,type); };
        // Click on the actual field should trigger prerequisite shake and popup
    const bindBlock = (el, handler) => { if (!el) return; el.addEventListener('mousedown', handler); el.addEventListener('click', handler); el.addEventListener('pointerdown', handler); };
        bindBlock(vehicleTypeSelect, (e)=>{ if (!(vehicleCategorySelect && vehicleCategorySelect.value)) { e.preventDefault(); e.stopImmediatePropagation(); triggerShake(vcGroup||vehicleCategorySelect); safeToast('Please select vehicle category first','error'); } });
    bindBlock(stateSelect, (e)=>{ if (!vehicleTypeSelect.value) { e.preventDefault(); e.stopImmediatePropagation(); triggerShake(vtGroup||vehicleTypeSelect); safeToast('Please select vehicle type first','error'); } });
    bindBlock(districtSelect, (e)=>{ if (!stateSelect.value && !window._prefilledDistrict) { e.preventDefault(); e.stopImmediatePropagation(); triggerShake(stateGroup||stateSelect); safeToast('Please select state first','error'); } });
        bindBlock(pincodeInput, (e)=>{
            if (!vehicleTypeSelect.value) { e.preventDefault(); e.stopImmediatePropagation(); triggerShake(vtGroup||vehicleTypeSelect); safeToast('Please select vehicle type first','error'); return; }
        });

        // Global deduped toast
        window.showToast = function(message, type = 'info') {
            const old = document.getElementById('globalToast');
            if (old) old.remove();
            const toast = document.createElement('div');
            toast.id = 'globalToast';
            toast.className = `toast toast-${type}`;
            // Safely render line breaks for messages joined with "<br>" without using innerHTML
            const raw = String(message ?? '');
            toast.textContent = '';
            const parts = raw.split(/<br\s*\/?>/i);
            parts.forEach((part, idx) => {
                toast.appendChild(document.createTextNode(part));
                if (idx < parts.length - 1) toast.appendChild(document.createElement('br'));
            });
            toast.style.cssText = `
                position: fixed;
                bottom: 30px;
                right: 30px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                color: white;
                padding: 14px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 10000;
            `;
            document.body.appendChild(toast);
            setTimeout(() => { toast.remove(); }, 3000);
        };

        // ===== Shake Helper =====
        function triggerShake(el) {
            if (!el) return;
            const group = el.closest('.form-group');
            if (!group) return;
            group.classList.add('shake');
            setTimeout(()=>group.classList.remove('shake'),600);
        }
    })();
    </script>
    
        <script>
            // Simplified: only GPS button now; user enters pincode manually otherwise.
            (function(){
                var apiBase = (window.API_BASE_URL || '').replace(/\/$/, '');
                var detectBtn = document.getElementById('detectLocationBtn');
                var pinInput = document.getElementById('pincode');
                var cityInput = document.getElementById('city');
                if (detectBtn && 'geolocation' in navigator && apiBase) {
                    detectBtn.addEventListener('click', function(){
                        detectBtn.disabled = true;
                        navigator.geolocation.getCurrentPosition(function(pos){
                            var lat = pos.coords.latitude, lon = pos.coords.longitude;
                            fetch(apiBase + '/api/geo/reverse?lat=' + encodeURIComponent(lat) + '&lon=' + encodeURIComponent(lon))
                                .then(r=>r.json())
                                .then(g=>{
                                    if (g.postal && pinInput) pinInput.value = g.postal;
                                    if (g.district && cityInput) cityInput.value = g.district;
                                })
                                .catch(()=>{})
                                .finally(()=>{ detectBtn.disabled = false; });
                        }, function(){ detectBtn.disabled = false; }, { timeout: 6000, enableHighAccuracy:false });
                    });
                }
            })();
        </script>
    
    <script>
        // Smart URL conversion - automatically adds .html for local development
        if (typeof window.buildUrl === 'function') {
            // Convert all internal links to use smart URLs
            const links = document.querySelectorAll('a[href^="index"], a[href^="driver-dashboard"]');
            links.forEach(link => {
                const href = link.getAttribute('href');
                if (href && !href.includes('?')) {
                    // For links without query parameters, just convert the base path
                    const path = href.split('?')[0];
                    link.href = window.buildUrl(path) + (href.includes('?') ? href.substring(href.indexOf('?')) : '');
                } else if (href && href.includes('?')) {
                    // For links with query parameters, convert the base path and keep the query
                    const path = href.split('?')[0];
                    const query = href.substring(href.indexOf('?'));
                    link.href = window.buildUrl(path) + query;
                }
            });
        }

        
  const messages = [
    "Your area is so peaceful, even the vehicles seem to be meditating!",
    "No vehicles found... looks like they’ve all taken a Sunday off. Try again on Monday!",
    "We spoke to the vehicle owners. They’re interested... just waiting for the right mood!",
    "We sent a vehicle to your location. It saw the traffic and said, 'Not today, bro.'",
    "We’re expanding fast—but your area is playing hard to get!",
    "Your PIN code is trending—but vehicles haven’t caught up yet!",
    "No vehicles yet. They’re probably binge-watching Netflix and ignoring our calls.",
    "No vehicles found. They’re probably stuck in a group chat deciding who goes first.",
    "Your area is trending... but vehicles are still updating their status. Refresh for drama!",
    "Your area’s giving premium vibes. Vehicle owners are still buffering...",
    "Your PIN code is calling. Vehicles are on silent mode!"
];

  window.onload = function () {
    const messageElement = document.getElementById("novehiclefoundResultsMessage");
    const randomIndex = Math.floor(Math.random() * messages.length);
    messageElement.textContent = messages[randomIndex];
  };

    </script>
    
</body>
</html> 
